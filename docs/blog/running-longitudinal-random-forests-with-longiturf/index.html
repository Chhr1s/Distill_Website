<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>

  <!--radix_placeholder_meta_tags-->
<title>Christopher Loan's Website: Comparing (Stochastic) Mixed-Effects Tree-Based Models in `{LongituRF}` &amp; `{ranger}`</title>

<meta property="description" itemprop="description" content="A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs &amp; Traditional Random Forests."/>

<link rel="icon" type="image/png" href="../../images/photo.png"/>

<!--  https://schema.org/Article -->
<meta property="article:published" itemprop="datePublished" content="2021-08-24"/>
<meta property="article:created" itemprop="dateCreated" content="2021-08-24"/>
<meta name="article:author" content="Christopher Loan"/>

<!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
<meta property="og:title" content="Christopher Loan&#39;s Website: Comparing (Stochastic) Mixed-Effects Tree-Based Models in `{LongituRF}` &amp; `{ranger}`"/>
<meta property="og:type" content="article"/>
<meta property="og:description" content="A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs &amp; Traditional Random Forests."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:site_name" content="Christopher Loan&#39;s Website"/>

<!--  https://dev.twitter.com/cards/types/summary -->
<meta property="twitter:card" content="summary"/>
<meta property="twitter:title" content="Christopher Loan&#39;s Website: Comparing (Stochastic) Mixed-Effects Tree-Based Models in `{LongituRF}` &amp; `{ranger}`"/>
<meta property="twitter:description" content="A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs &amp; Traditional Random Forests."/>

<!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

<script type="text/json" id="radix-rmarkdown-metadata">
{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","output","draft"]}},"value":[{"type":"character","attributes":{},"value":["Comparing (Stochastic) Mixed-Effects Tree-Based Models in `{LongituRF}` & `{ranger}`"]},{"type":"character","attributes":{},"value":["A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs & Traditional Random Forests."]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Christopher Loan"]}]}]},{"type":"character","attributes":{},"value":["2021-08-24"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","code_folding"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["show"]}]}]},{"type":"logical","attributes":{},"value":[false]}]}
</script>
<!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["Imputed Data/year_2015_imputed.csv","Imputed Data/year_2016_imputed.csv","Imputed Data/year_2017_imputed.csv","Imputed Data/year_2018_imputed.csv","running-longitudinal-random-forests-with-longiturf_files/anchor-4.2.2/anchor.min.js","running-longitudinal-random-forests-with-longiturf_files/bowser-1.9.3/bowser.min.js","running-longitudinal-random-forests-with-longiturf_files/distill-2.2.21/template.v2.js","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-25-1.png","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-26-1.png","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-28-1.png","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-29-1.png","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-30-1.png","running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-31-1.png","running-longitudinal-random-forests-with-longiturf_files/header-attrs-2.6/header-attrs.js","running-longitudinal-random-forests-with-longiturf_files/jquery-1.11.3/jquery.min.js","running-longitudinal-random-forests-with-longiturf_files/popper-2.6.0/popper.min.js","running-longitudinal-random-forests-with-longiturf_files/tippy-6.2.7/tippy-bundle.umd.min.js","running-longitudinal-random-forests-with-longiturf_files/tippy-6.2.7/tippy-light-border.css","running-longitudinal-random-forests-with-longiturf_files/tippy-6.2.7/tippy.css","running-longitudinal-random-forests-with-longiturf_files/tippy-6.2.7/tippy.umd.min.js","running-longitudinal-random-forests-with-longiturf_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
<meta name="distill:offset" content="../.."/>

<script type="application/javascript">

  window.headroom_prevent_pin = false;

  window.document.addEventListener("DOMContentLoaded", function (event) {

    // initialize headroom for banner
    var header = $('header').get(0);
    var headerHeight = header.offsetHeight;
    var headroom = new Headroom(header, {
      tolerance: 5,
      onPin : function() {
        if (window.headroom_prevent_pin) {
          window.headroom_prevent_pin = false;
          headroom.unpin();
        }
      }
    });
    headroom.init();
    if(window.location.hash)
      headroom.unpin();
    $(header).addClass('headroom--transition');

    // offset scroll location for banner on hash change
    // (see: https://github.com/WickyNilliams/headroom.js/issues/38)
    window.addEventListener("hashchange", function(event) {
      window.scrollTo(0, window.pageYOffset - (headerHeight + 25));
    });

    // responsive menu
    $('.distill-site-header').each(function(i, val) {
      var topnav = $(this);
      var toggle = topnav.find('.nav-toggle');
      toggle.on('click', function() {
        topnav.toggleClass('responsive');
      });
    });

    // nav dropdowns
    $('.nav-dropbtn').click(function(e) {
      $(this).next('.nav-dropdown-content').toggleClass('nav-dropdown-active');
      $(this).parent().siblings('.nav-dropdown')
         .children('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $("body").click(function(e){
      $('.nav-dropdown-content').removeClass('nav-dropdown-active');
    });
    $(".nav-dropdown").click(function(e){
      e.stopPropagation();
    });
  });
</script>

<style type="text/css">

/* Theme (user-documented overrideables for nav appearance) */

.distill-site-nav {
  color: rgba(255, 255, 255, 0.8);
  background-color: #0F2E3D;
  font-size: 15px;
  font-weight: 300;
}

.distill-site-nav a {
  color: inherit;
  text-decoration: none;
}

.distill-site-nav a:hover {
  color: white;
}

@media print {
  .distill-site-nav {
    display: none;
  }
}

.distill-site-header {

}

.distill-site-footer {

}


/* Site Header */

.distill-site-header {
  width: 100%;
  box-sizing: border-box;
  z-index: 3;
}

.distill-site-header .nav-left {
  display: inline-block;
  margin-left: 8px;
}

@media screen and (max-width: 768px) {
  .distill-site-header .nav-left {
    margin-left: 0;
  }
}


.distill-site-header .nav-right {
  float: right;
  margin-right: 8px;
}

.distill-site-header a,
.distill-site-header .title {
  display: inline-block;
  text-align: center;
  padding: 14px 10px 14px 10px;
}

.distill-site-header .title {
  font-size: 18px;
  min-width: 150px;
}

.distill-site-header .logo {
  padding: 0;
}

.distill-site-header .logo img {
  display: none;
  max-height: 20px;
  width: auto;
  margin-bottom: -4px;
}

.distill-site-header .nav-image img {
  max-height: 18px;
  width: auto;
  display: inline-block;
  margin-bottom: -3px;
}



@media screen and (min-width: 1000px) {
  .distill-site-header .logo img {
    display: inline-block;
  }
  .distill-site-header .nav-left {
    margin-left: 20px;
  }
  .distill-site-header .nav-right {
    margin-right: 20px;
  }
  .distill-site-header .title {
    padding-left: 12px;
  }
}


.distill-site-header .nav-toggle {
  display: none;
}

.nav-dropdown {
  display: inline-block;
  position: relative;
}

.nav-dropdown .nav-dropbtn {
  border: none;
  outline: none;
  color: rgba(255, 255, 255, 0.8);
  padding: 16px 10px;
  background-color: transparent;
  font-family: inherit;
  font-size: inherit;
  font-weight: inherit;
  margin: 0;
  margin-top: 1px;
  z-index: 2;
}

.nav-dropdown-content {
  display: none;
  position: absolute;
  background-color: white;
  min-width: 200px;
  border: 1px solid rgba(0,0,0,0.15);
  border-radius: 4px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
  z-index: 1;
  margin-top: 2px;
  white-space: nowrap;
  padding-top: 4px;
  padding-bottom: 4px;
}

.nav-dropdown-content hr {
  margin-top: 4px;
  margin-bottom: 4px;
  border: none;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.nav-dropdown-active {
  display: block;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
  color: black;
  padding: 6px 24px;
  text-decoration: none;
  display: block;
  text-align: left;
}

.nav-dropdown-content .nav-dropdown-header {
  display: block;
  padding: 5px 24px;
  padding-bottom: 0;
  text-transform: uppercase;
  font-size: 14px;
  color: #999999;
  white-space: nowrap;
}

.nav-dropdown:hover .nav-dropbtn {
  color: white;
}

.nav-dropdown-content a:hover {
  background-color: #ddd;
  color: black;
}

.nav-right .nav-dropdown-content {
  margin-left: -45%;
  right: 0;
}

@media screen and (max-width: 768px) {
  .distill-site-header a, .distill-site-header .nav-dropdown  {display: none;}
  .distill-site-header a.nav-toggle {
    float: right;
    display: block;
  }
  .distill-site-header .title {
    margin-left: 0;
  }
  .distill-site-header .nav-right {
    margin-right: 0;
  }
  .distill-site-header {
    overflow: hidden;
  }
  .nav-right .nav-dropdown-content {
    margin-left: 0;
  }
}


@media screen and (max-width: 768px) {
  .distill-site-header.responsive {position: relative; min-height: 500px; }
  .distill-site-header.responsive a.nav-toggle {
    position: absolute;
    right: 0;
    top: 0;
  }
  .distill-site-header.responsive a,
  .distill-site-header.responsive .nav-dropdown {
    display: block;
    text-align: left;
  }
  .distill-site-header.responsive .nav-left,
  .distill-site-header.responsive .nav-right {
    width: 100%;
  }
  .distill-site-header.responsive .nav-dropdown {float: none;}
  .distill-site-header.responsive .nav-dropdown-content {position: relative;}
  .distill-site-header.responsive .nav-dropdown .nav-dropbtn {
    display: block;
    width: 100%;
    text-align: left;
  }
}

/* Site Footer */

.distill-site-footer {
  width: 100%;
  overflow: hidden;
  box-sizing: border-box;
  z-index: 3;
  margin-top: 30px;
  padding-top: 30px;
  padding-bottom: 30px;
  text-align: center;
}

/* Headroom */

d-title {
  padding-top: 6rem;
}

@media print {
  d-title {
    padding-top: 4rem;
  }
}

.headroom {
  z-index: 1000;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
}

.headroom--transition {
  transition: all .4s ease-in-out;
}

.headroom--unpinned {
  top: -100px;
}

.headroom--pinned {
  top: 0;
}

/* adjust viewport for navbar height */
/* helps vertically center bootstrap (non-distill) content */
.min-vh-100 {
  min-height: calc(100vh - 100px) !important;
}

</style>

<script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
<link href="../../site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet"/>
<link href="../../site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet"/>
<script src="../../site_libs/headroom-0.9.4/headroom.min.js"></script>
<!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

<style type="text/css">

body {
  background-color: white;
}

.pandoc-table {
  width: 100%;
}

.pandoc-table>caption {
  margin-bottom: 10px;
}

.pandoc-table th:not([align]) {
  text-align: left;
}

.pagedtable-footer {
  font-size: 15px;
}

d-byline .byline {
  grid-template-columns: 2fr 2fr;
}

d-byline .byline h3 {
  margin-block-start: 1.5em;
}

d-byline .byline .authors-affiliations h3 {
  margin-block-start: 0.5em;
}

.authors-affiliations .orcid-id {
  width: 16px;
  height:16px;
  margin-left: 4px;
  margin-right: 4px;
  vertical-align: middle;
  padding-bottom: 2px;
}

d-title .dt-tags {
  margin-top: 1em;
  grid-column: text;
}

.dt-tags .dt-tag {
  text-decoration: none;
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0em 0.4em;
  margin-right: 0.5em;
  margin-bottom: 0.4em;
  font-size: 70%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

d-article table.gt_table td,
d-article table.gt_table th {
  border-bottom: none;
}

.html-widget {
  margin-bottom: 2.0em;
}

.l-screen-inset {
  padding-right: 16px;
}

.l-screen .caption {
  margin-left: 10px;
}

.shaded {
  background: rgb(247, 247, 247);
  padding-top: 20px;
  padding-bottom: 20px;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .html-widget {
  margin-bottom: 0;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.shaded .shaded-content {
  background: white;
}

.text-output {
  margin-top: 0;
  line-height: 1.5em;
}

.hidden {
  display: none !important;
}

d-article {
  padding-top: 2.5rem;
  padding-bottom: 30px;
}

d-appendix {
  padding-top: 30px;
}

d-article>p>img {
  width: 100%;
}

d-article h2 {
  margin: 1rem 0 1.5rem 0;
}

d-article h3 {
  margin-top: 1.5rem;
}

d-article iframe {
  border: 1px solid rgba(0, 0, 0, 0.1);
  margin-bottom: 2.0em;
  width: 100%;
}

/* Tweak code blocks */

d-article div.sourceCode code,
d-article pre code {
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
}

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: auto;
}

d-article div.sourceCode {
  background-color: white;
}

d-article div.sourceCode pre {
  padding-left: 10px;
  font-size: 12px;
  border-left: 2px solid rgba(0,0,0,0.1);
}

d-article pre {
  font-size: 12px;
  color: black;
  background: none;
  margin-top: 0;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

d-article pre a {
  border-bottom: none;
}

d-article pre a:hover {
  border-bottom: none;
  text-decoration: underline;
}

d-article details {
  grid-column: text;
  margin-bottom: 0.8em;
}

@media(min-width: 768px) {

d-article pre,
d-article div.sourceCode,
d-article div.sourceCode pre {
  overflow: visible !important;
}

d-article div.sourceCode pre {
  padding-left: 18px;
  font-size: 14px;
}

d-article pre {
  font-size: 14px;
}

}

figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

/* CSS for d-contents */

.d-contents {
  grid-column: text;
  color: rgba(0,0,0,0.8);
  font-size: 0.9em;
  padding-bottom: 1em;
  margin-bottom: 1em;
  padding-bottom: 0.5em;
  margin-bottom: 1em;
  padding-left: 0.25em;
  justify-self: start;
}

@media(min-width: 1000px) {
  .d-contents.d-contents-float {
    height: 0;
    grid-column-start: 1;
    grid-column-end: 4;
    justify-self: center;
    padding-right: 3em;
    padding-left: 2em;
  }
}

.d-contents nav h3 {
  font-size: 18px;
  margin-top: 0;
  margin-bottom: 1em;
}

.d-contents li {
  list-style-type: none
}

.d-contents nav > ul {
  padding-left: 0;
}

.d-contents ul {
  padding-left: 1em
}

.d-contents nav ul li {
  margin-top: 0.6em;
  margin-bottom: 0.2em;
}

.d-contents nav a {
  font-size: 13px;
  border-bottom: none;
  text-decoration: none
  color: rgba(0, 0, 0, 0.8);
}

.d-contents nav a:hover {
  text-decoration: underline solid rgba(0, 0, 0, 0.6)
}

.d-contents nav > ul > li > a {
  font-weight: 600;
}

.d-contents nav > ul > li > ul {
  font-weight: inherit;
}

.d-contents nav > ul > li > ul > li {
  margin-top: 0.2em;
}


.d-contents nav ul {
  margin-top: 0;
  margin-bottom: 0.25em;
}

.d-article-with-toc h2:nth-child(2) {
  margin-top: 0;
}


/* Figure */

.figure {
  position: relative;
  margin-bottom: 2.5em;
  margin-top: 1.5em;
}

.figure img {
  width: 100%;
}

.figure .caption {
  color: rgba(0, 0, 0, 0.6);
  font-size: 12px;
  line-height: 1.5em;
}

.figure img.external {
  background: white;
  border: 1px solid rgba(0, 0, 0, 0.1);
  box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
  padding: 18px;
  box-sizing: border-box;
}

.figure .caption a {
  color: rgba(0, 0, 0, 0.6);
}

.figure .caption b,
.figure .caption strong, {
  font-weight: 600;
  color: rgba(0, 0, 0, 1.0);
}

/* Citations */

d-article .citation {
  color: inherit;
  cursor: inherit;
}

div.hanging-indent{
  margin-left: 1em; text-indent: -1em;
}

/* Citation hover box */

.tippy-box[data-theme~=light-border] {
  background-color: rgba(250, 250, 250, 0.95);
}

.tippy-content > p {
  margin-bottom: 0;
  padding: 2px;
}


/* Tweak 1000px media break to show more text */

@media(min-width: 1000px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 16px;
  }

  .grid {
    grid-column-gap: 16px;
  }

  d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
  }
  figure .caption, .figure .caption, figure figcaption {
    font-size: 13px;
  }
}

@media(min-width: 1180px) {
  .base-grid,
  distill-header,
  d-title,
  d-abstract,
  d-article,
  d-appendix,
  distill-appendix,
  d-byline,
  d-footnote-list,
  d-citation-list,
  distill-footer {
    grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
    grid-column-gap: 32px;
  }

  .grid {
    grid-column-gap: 32px;
  }
}


/* Get the citation styles for the appendix (not auto-injected on render since
   we do our own rendering of the citation appendix) */

d-appendix .citation-appendix,
.d-appendix .citation-appendix {
  font-size: 11px;
  line-height: 15px;
  border-left: 1px solid rgba(0, 0, 0, 0.1);
  padding-left: 18px;
  border: 1px solid rgba(0,0,0,0.1);
  background: rgba(0, 0, 0, 0.02);
  padding: 10px 18px;
  border-radius: 3px;
  color: rgba(150, 150, 150, 1);
  overflow: hidden;
  margin-top: -12px;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Include appendix styles here so they can be overridden */

d-appendix {
  contain: layout style;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-top: 60px;
  margin-bottom: 0;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  color: rgba(0,0,0,0.5);
  padding-top: 60px;
  padding-bottom: 48px;
}

d-appendix h3 {
  grid-column: page-start / text-start;
  font-size: 15px;
  font-weight: 500;
  margin-top: 1em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.65);
}

d-appendix h3 + * {
  margin-top: 1em;
}

d-appendix ol {
  padding: 0 0 0 15px;
}

@media (min-width: 768px) {
  d-appendix ol {
    padding: 0 0 0 30px;
    margin-left: -30px;
  }
}

d-appendix li {
  margin-bottom: 1em;
}

d-appendix a {
  color: rgba(0, 0, 0, 0.6);
}

d-appendix > * {
  grid-column: text;
}

d-appendix > d-footnote-list,
d-appendix > d-citation-list,
d-appendix > distill-appendix {
  grid-column: screen;
}

/* Include footnote styles here so they can be overridden */

d-footnote-list {
  contain: layout style;
}

d-footnote-list > * {
  grid-column: text;
}

d-footnote-list a.footnote-backlink {
  color: rgba(0,0,0,0.3);
  padding-left: 0.5em;
}



/* Anchor.js */

.anchorjs-link {
  /*transition: all .25s linear; */
  text-decoration: none;
  border-bottom: none;
}
*:hover > .anchorjs-link {
  margin-left: -1.125em !important;
  text-decoration: none;
  border-bottom: none;
}

/* Social footer */

.social_footer {
  margin-top: 30px;
  margin-bottom: 0;
  color: rgba(0,0,0,0.67);
}

.disqus-comments {
  margin-right: 30px;
}

.disqus-comment-count {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  cursor: pointer;
}

#disqus_thread {
  margin-top: 30px;
}

.article-sharing a {
  border-bottom: none;
  margin-right: 8px;
}

.article-sharing a:hover {
  border-bottom: none;
}

.sidebar-section.subscribe {
  font-size: 12px;
  line-height: 1.6em;
}

.subscribe p {
  margin-bottom: 0.5em;
}


.article-footer .subscribe {
  font-size: 15px;
  margin-top: 45px;
}


.sidebar-section.custom {
  font-size: 12px;
  line-height: 1.6em;
}

.custom p {
  margin-bottom: 0.5em;
}

/* Styles for listing layout (hide title) */
.layout-listing d-title, .layout-listing .d-title {
  display: none;
}

/* Styles for posts lists (not auto-injected) */


.posts-with-sidebar {
  padding-left: 45px;
  padding-right: 45px;
}

.posts-list .description h2,
.posts-list .description p {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
}

.posts-list .description h2 {
  font-weight: 700;
  border-bottom: none;
  padding-bottom: 0;
}

.posts-list h2.post-tag {
  border-bottom: 1px solid rgba(0, 0, 0, 0.2);
  padding-bottom: 12px;
}
.posts-list {
  margin-top: 60px;
  margin-bottom: 24px;
}

.posts-list .post-preview {
  text-decoration: none;
  overflow: hidden;
  display: block;
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  padding: 24px 0;
}

.post-preview-last {
  border-bottom: none !important;
}

.posts-list .posts-list-caption {
  grid-column: screen;
  font-weight: 400;
}

.posts-list .post-preview h2 {
  margin: 0 0 6px 0;
  line-height: 1.2em;
  font-style: normal;
  font-size: 24px;
}

.posts-list .post-preview p {
  margin: 0 0 12px 0;
  line-height: 1.4em;
  font-size: 16px;
}

.posts-list .post-preview .thumbnail {
  box-sizing: border-box;
  margin-bottom: 24px;
  position: relative;
  max-width: 500px;
}
.posts-list .post-preview img {
  width: 100%;
  display: block;
}

.posts-list .metadata {
  font-size: 12px;
  line-height: 1.4em;
  margin-bottom: 18px;
}

.posts-list .metadata > * {
  display: inline-block;
}

.posts-list .metadata .publishedDate {
  margin-right: 2em;
}

.posts-list .metadata .dt-authors {
  display: block;
  margin-top: 0.3em;
  margin-right: 2em;
}

.posts-list .dt-tags {
  display: block;
  line-height: 1em;
}

.posts-list .dt-tags .dt-tag {
  display: inline-block;
  color: rgba(0,0,0,0.6);
  padding: 0.3em 0.4em;
  margin-right: 0.2em;
  margin-bottom: 0.4em;
  font-size: 60%;
  border: 1px solid rgba(0,0,0,0.2);
  border-radius: 3px;
  text-transform: uppercase;
  font-weight: 500;
}

.posts-list img {
  opacity: 1;
}

.posts-list img[data-src] {
  opacity: 0;
}

.posts-more {
  clear: both;
}


.posts-sidebar {
  font-size: 16px;
}

.posts-sidebar h3 {
  font-size: 16px;
  margin-top: 0;
  margin-bottom: 0.5em;
  font-weight: 400;
  text-transform: uppercase;
}

.sidebar-section {
  margin-bottom: 30px;
}

.categories ul {
  list-style-type: none;
  margin: 0;
  padding: 0;
}

.categories li {
  color: rgba(0, 0, 0, 0.8);
  margin-bottom: 0;
}

.categories li>a {
  border-bottom: none;
}

.categories li>a:hover {
  border-bottom: 1px solid rgba(0, 0, 0, 0.4);
}

.categories .active {
  font-weight: 600;
}

.categories .category-count {
  color: rgba(0, 0, 0, 0.4);
}


@media(min-width: 768px) {
  .posts-list .post-preview h2 {
    font-size: 26px;
  }
  .posts-list .post-preview .thumbnail {
    float: right;
    width: 30%;
    margin-bottom: 0;
  }
  .posts-list .post-preview .description {
    float: left;
    width: 45%;
  }
  .posts-list .post-preview .metadata {
    float: left;
    width: 20%;
    margin-top: 8px;
  }
  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.5em;
    font-size: 16px;
  }
  .posts-with-sidebar .posts-list {
    float: left;
    width: 75%;
  }
  .posts-with-sidebar .posts-sidebar {
    float: right;
    width: 20%;
    margin-top: 60px;
    padding-top: 24px;
    padding-bottom: 24px;
  }
}


/* Improve display for browsers without grid (IE/Edge <= 15) */

.downlevel {
  line-height: 1.6em;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  margin: 0;
}

.downlevel .d-title {
  padding-top: 6rem;
  padding-bottom: 1.5rem;
}

.downlevel .d-title h1 {
  font-size: 50px;
  font-weight: 700;
  line-height: 1.1em;
  margin: 0 0 0.5rem;
}

.downlevel .d-title p {
  font-weight: 300;
  font-size: 1.2rem;
  line-height: 1.55em;
  margin-top: 0;
}

.downlevel .d-byline {
  padding-top: 0.8em;
  padding-bottom: 0.8em;
  font-size: 0.8rem;
  line-height: 1.8em;
}

.downlevel .section-separator {
  border: none;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
}

.downlevel .d-article {
  font-size: 1.06rem;
  line-height: 1.7em;
  padding-top: 1rem;
  padding-bottom: 2rem;
}


.downlevel .d-appendix {
  padding-left: 0;
  padding-right: 0;
  max-width: none;
  font-size: 0.8em;
  line-height: 1.7em;
  margin-bottom: 0;
  color: rgba(0,0,0,0.5);
  padding-top: 40px;
  padding-bottom: 48px;
}

.downlevel .footnotes ol {
  padding-left: 13px;
}

.downlevel .base-grid,
.downlevel .distill-header,
.downlevel .d-title,
.downlevel .d-abstract,
.downlevel .d-article,
.downlevel .d-appendix,
.downlevel .distill-appendix,
.downlevel .d-byline,
.downlevel .d-footnote-list,
.downlevel .d-citation-list,
.downlevel .distill-footer,
.downlevel .appendix-bottom,
.downlevel .posts-container {
  padding-left: 40px;
  padding-right: 40px;
}

@media(min-width: 768px) {
  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
  padding-left: 150px;
  padding-right: 150px;
  max-width: 900px;
}
}

.downlevel pre code {
  display: block;
  border-left: 2px solid rgba(0, 0, 0, .1);
  padding: 0 0 0 20px;
  font-size: 14px;
}

.downlevel code, .downlevel pre {
  color: black;
  background: none;
  font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  text-align: left;
  white-space: pre;
  word-spacing: normal;
  word-break: normal;
  word-wrap: normal;
  line-height: 1.5;

  -moz-tab-size: 4;
  -o-tab-size: 4;
  tab-size: 4;

  -webkit-hyphens: none;
  -moz-hyphens: none;
  -ms-hyphens: none;
  hyphens: none;
}

.downlevel .posts-list .post-preview {
  color: inherit;
}



</style>

<script type="application/javascript">

function is_downlevel_browser() {
  if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                 window.navigator.userAgent)) {
    return true;
  } else {
    return window.load_distill_framework === undefined;
  }
}

// show body when load is complete
function on_load_complete() {

  // add anchors
  if (window.anchors) {
    window.anchors.options.placement = 'left';
    window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
  }


  // set body to visible
  document.body.style.visibility = 'visible';

  // force redraw for leaflet widgets
  if (window.HTMLWidgets) {
    var maps = window.HTMLWidgets.findAll(".leaflet");
    $.each(maps, function(i, el) {
      var map = this.getMap();
      map.invalidateSize();
      map.eachLayer(function(layer) {
        if (layer instanceof L.TileLayer)
          layer.redraw();
      });
    });
  }

  // trigger 'shown' so htmlwidgets resize
  $('d-article').trigger('shown');
}

function init_distill() {

  init_common();

  // create front matter
  var front_matter = $('<d-front-matter></d-front-matter>');
  $('#distill-front-matter').wrap(front_matter);

  // create d-title
  $('.d-title').changeElementType('d-title');

  // create d-byline
  var byline = $('<d-byline></d-byline>');
  $('.d-byline').replaceWith(byline);

  // create d-article
  var article = $('<d-article></d-article>');
  $('.d-article').wrap(article).children().unwrap();

  // move posts container into article
  $('.posts-container').appendTo($('d-article'));

  // create d-appendix
  $('.d-appendix').changeElementType('d-appendix');

  // flag indicating that we have appendix items
  var appendix = $('.appendix-bottom').children('h3').length > 0;

  // replace footnotes with <d-footnote>
  $('.footnote-ref').each(function(i, val) {
    appendix = true;
    var href = $(this).attr('href');
    var id = href.replace('#', '');
    var fn = $('#' + id);
    var fn_p = $('#' + id + '>p');
    fn_p.find('.footnote-back').remove();
    var text = fn_p.html();
    var dtfn = $('<d-footnote></d-footnote>');
    dtfn.html(text);
    $(this).replaceWith(dtfn);
  });
  // remove footnotes
  $('.footnotes').remove();

  // move refs into #references-listing
  $('#references-listing').replaceWith($('#refs'));

  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    var id = $(this).attr('id');
    $('.d-contents a[href="#' + id + '"]').parent().remove();
    appendix = true;
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
  });

  // show d-appendix if we have appendix content
  $("d-appendix").css('display', appendix ? 'grid' : 'none');

  // localize layout chunks to just output
  $('.layout-chunk').each(function(i, val) {

    // capture layout
    var layout = $(this).attr('data-layout');

    // apply layout to markdown level block elements
    var elements = $(this).children().not('details, div.sourceCode, pre, script');
    elements.each(function(i, el) {
      var layout_div = $('<div class="' + layout + '"></div>');
      if (layout_div.hasClass('shaded')) {
        var shaded_content = $('<div class="shaded-content"></div>');
        $(this).wrap(shaded_content);
        $(this).parent().wrap(layout_div);
      } else {
        $(this).wrap(layout_div);
      }
    });


    // unwrap the layout-chunk div
    $(this).children().unwrap();
  });

  // remove code block used to force  highlighting css
  $('.distill-force-highlighting-css').parent().remove();

  // remove empty line numbers inserted by pandoc when using a
  // custom syntax highlighting theme
  $('code.sourceCode a:empty').remove();

  // load distill framework
  load_distill_framework();

  // wait for window.distillRunlevel == 4 to do post processing
  function distill_post_process() {

    if (!window.distillRunlevel || window.distillRunlevel < 4)
      return;

    // hide author/affiliations entirely if we have no authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;
    if (!have_authors)
      $('d-byline').addClass('hidden');

    // article with toc class
    $('.d-contents').parent().addClass('d-article-with-toc');

    // strip links that point to #
    $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

    // add orcid ids
    $('.authors-affiliations').find('.author').each(function(i, el) {
      var orcid_id = front_matter.authors[i].orcidID;
      if (orcid_id) {
        var a = $('<a></a>');
        a.attr('href', 'https://orcid.org/' + orcid_id);
        var img = $('<img></img>');
        img.addClass('orcid-id');
        img.attr('alt', 'ORCID ID');
        img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
        a.append(img);
        $(this).append(a);
      }
    });

    // hide elements of author/affiliations grid that have no value
    function hide_byline_column(caption) {
      $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
    }

    // affiliations
    var have_affiliations = false;
    for (var i = 0; i<front_matter.authors.length; ++i) {
      var author = front_matter.authors[i];
      if (author.affiliation !== "&nbsp;") {
        have_affiliations = true;
        break;
      }
    }
    if (!have_affiliations)
      $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

    // published date
    if (!front_matter.publishedDate)
      hide_byline_column("Published");

    // document object identifier
    var doi = $('d-byline').find('h3:contains("DOI")');
    var doi_p = doi.next().empty();
    if (!front_matter.doi) {
      // if we have a citation and valid citationText then link to that
      if ($('#citation').length > 0 && front_matter.citationText) {
        doi.html('Citation');
        $('<a href="#citation"></a>')
          .text(front_matter.citationText)
          .appendTo(doi_p);
      } else {
        hide_byline_column("DOI");
      }
    } else {
      $('<a></a>')
         .attr('href', "https://doi.org/" + front_matter.doi)
         .html(front_matter.doi)
         .appendTo(doi_p);
    }

     // change plural form of authors/affiliations
    if (front_matter.authors.length === 1) {
      var grid = $('.authors-affiliations');
      grid.children('h3:contains("Authors")').text('Author');
      grid.children('h3:contains("Affiliations")').text('Affiliation');
    }

    // remove d-appendix and d-footnote-list local styles
    $('d-appendix > style:first-child').remove();
    $('d-footnote-list > style:first-child').remove();

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // hoverable references
    $('span.citation[data-cites]').each(function() {
      var refs = $(this).attr('data-cites').split(" ");
      var refHtml = refs.map(function(ref) {
        return "<p>" + $('#ref-' + ref).html() + "</p>";
      }).join("\n");
      window.tippy(this, {
        allowHTML: true,
        content: refHtml,
        maxWidth: 500,
        interactive: true,
        interactiveBorder: 10,
        theme: 'light-border',
        placement: 'bottom-start'
      });
    });

    // clear polling timer
    clearInterval(tid);

    // show body now that everything is ready
    on_load_complete();
  }

  var tid = setInterval(distill_post_process, 50);
  distill_post_process();

}

function init_downlevel() {

  init_common();

   // insert hr after d-title
  $('.d-title').after($('<hr class="section-separator"/>'));

  // check if we have authors
  var front_matter = JSON.parse($("#distill-front-matter").html());
  var have_authors = front_matter.authors && front_matter.authors.length > 0;

  // manage byline/border
  if (!have_authors)
    $('.d-byline').remove();
  $('.d-byline').after($('<hr class="section-separator"/>'));
  $('.d-byline a').remove();

  // remove toc
  $('.d-contents').remove();

  // move appendix elements
  $('h1.appendix, h2.appendix').each(function(i, val) {
    $(this).changeElementType('h3');
  });
  $('h3.appendix').each(function(i, val) {
    $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
  });


  // inject headers into references and footnotes
  var refs_header = $('<h3></h3>');
  refs_header.text('References');
  $('#refs').prepend(refs_header);

  var footnotes_header = $('<h3></h3');
  footnotes_header.text('Footnotes');
  $('.footnotes').children('hr').first().replaceWith(footnotes_header);

  // move appendix-bottom entries to the bottom
  $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
  $('.appendix-bottom').remove();

  // remove appendix if it's empty
  if ($('.d-appendix').children().length === 0)
    $('.d-appendix').remove();

  // prepend separator above appendix
  $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

  // trim code
  $('pre>code').each(function(i, val) {
    $(this).html($.trim($(this).html()));
  });

  // move posts-container right before article
  $('.posts-container').insertBefore($('.d-article'));

  $('body').addClass('downlevel');

  on_load_complete();
}


function init_common() {

  // jquery plugin to change element types
  (function($) {
    $.fn.changeElementType = function(newType) {
      var attrs = {};

      $.each(this[0].attributes, function(idx, attr) {
        attrs[attr.nodeName] = attr.nodeValue;
      });

      this.replaceWith(function() {
        return $("<" + newType + "/>", attrs).append($(this).contents());
      });
    };
  })(jQuery);

  // prevent underline for linked images
  $('a > img').parent().css({'border-bottom' : 'none'});

  // mark non-body figures created by knitr chunks as 100% width
  $('.layout-chunk').each(function(i, val) {
    var figures = $(this).find('img, .html-widget');
    if ($(this).attr('data-layout') !== "l-body") {
      figures.css('width', '100%');
    } else {
      figures.css('max-width', '100%');
      figures.filter("[width]").each(function(i, val) {
        var fig = $(this);
        fig.css('width', fig.attr('width') + 'px');
      });

    }
  });

  // auto-append index.html to post-preview links in file: protocol
  // and in rstudio ide preview
  $('.post-preview').each(function(i, val) {
    if (window.location.protocol === "file:")
      $(this).attr('href', $(this).attr('href') + "index.html");
  });

  // get rid of index.html references in header
  if (window.location.protocol !== "file:") {
    $('.distill-site-header a[href]').each(function(i,val) {
      $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
    });
  }

  // add class to pandoc style tables
  $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
  $('.kable-table').children('table').addClass('pandoc-table');

  // add figcaption style to table captions
  $('caption').parent('table').addClass("figcaption");

  // initialize posts list
  if (window.init_posts_list)
    window.init_posts_list();

  // implmement disqus comment link
  $('.disqus-comment-count').click(function() {
    window.headroom_prevent_pin = true;
    $('#disqus_thread').toggleClass('hidden');
    if (!$('#disqus_thread').hasClass('hidden')) {
      var offset = $(this).offset();
      $(window).resize();
      $('html, body').animate({
        scrollTop: offset.top - 35
      });
    }
  });
}

document.addEventListener('DOMContentLoaded', function() {
  if (is_downlevel_browser())
    init_downlevel();
  else
    window.addEventListener('WebComponentsReady', init_distill);
});

</script>

<!--/radix_placeholder_distill-->
  <script src="../../site_libs/header-attrs-2.6/header-attrs.js"></script>
  <script src="../../site_libs/jquery-1.11.3/jquery.min.js"></script>
  <script src="../../site_libs/popper-2.6.0/popper.min.js"></script>
  <link href="../../site_libs/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="../../site_libs/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="../../site_libs/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="../../site_libs/anchor-4.2.2/anchor.min.js"></script>
  <script src="../../site_libs/bowser-1.9.3/bowser.min.js"></script>
  <script src="../../site_libs/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="../../site_libs/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
<style type="text/css">

/* base variables */

/* Edit the CSS properties in this file to create a custom
   Distill theme. Only edit values in the right column
   for each row; values shown are the CSS defaults.
   To return any property to the default,
   you may set its value to: unset
   All rows must end with a semi-colon.                      */

/* Optional: embed custom fonts here with `@import`          */
/* This must remain at the top of this file.                 */

@import url('https://fonts.googleapis.com/css2?family=Antic+Slab&family=Raleway:ital@0;1&family=Source+Code+Pro:ital,wght@1,300&display=swap');

body {
  font-family: 'Raleway', sans-serif;
  background-color: #072a46d1;
  color: rgb(255 255 255);
}

figcaption, .figcaption {
    color: rgb(255 255 255 / 80%);
}

d-byline h3 {
    font-size: 0.6rem;
    font-weight: 400;
    color: rgb(255 255 255);
    margin: 0;
    text-transform: uppercase;
}

d-byline a, d-article d-byline a {
    color: rgb(255 255 255);
    text-decoration: none;
    border-bottom: none;
}

html {
  /*-- Main font sizes --*/
  --title-size:      50px;
  --body-size:       1.06rem;
  --code-size:       14px;
  --aside-size:      12px;
  --fig-cap-size:    13px;
  /*-- Main font colors --*/
  --title-color:     rgb(255 255 255);
  --header-color:    rgb(255 255 255);
  --body-color:      rgb(255 255 255);
  --aside-color:     rgb(255 255 255);
  --fig-cap-color:   rgb(255 255 255);
  /*-- Specify custom fonts ~~~ must be imported above   --*/
  --heading-font:    sans-serif;
  --mono-font:       monospace;
  --body-font:       sans-serif;
  --navbar-font:     sans-serif;  /* websites + blogs only */
}

/*-- ARTICLE METADATA --*/
d-byline {
  color: rgb(255 255 255);
  background-color: rgb(120 157 175);
  --heading-size:    0.6rem;
  --heading-color:   rgb(255 255 255);
  --body-size:       0.8rem;
  --body-color:      rgb(255 255 255);
}

d-article {
  color: rgb(255 255 255);
}


/*-- ARTICLE TABLE OF CONTENTS --*/
.d-contents {
  --heading-size:    18px;
  --contents-size:   13px;
}

/*-- ARTICLE APPENDIX --*/
d-appendix {
  --heading-size:    15px;
  --heading-color:   rgb(255 255 255);
  --text-size:       0.8em;
  --text-color:      rgb(255 255 255);
}

/*-- WEBSITE HEADER + FOOTER --*/
/* These properties only apply to Distill sites and blogs  */

.distill-site-header {
  --title-size:       18px;
  --text-color:       rgb(255 255 255)
  --text-size:        15px;
  --hover-color:      white;
  background-color: #000000;
  border-top-color: #184eb9;
  border-left-color: #184eb9;
  border-right-color: #184eb9;
  border-top-width: 4px;
  border-left-width: 2px;
  border-right-width: 2px;
  border-bottom-color: rgb(255 255 255/65%);
  border-bottom-width: 2px;
  font-size: 18px;
  text-transform: lowercase;
}

.distill-site-footer {
  --text-color:       rgb(255 255 255)
  --text-size:        15px;
  --hover-color:      white;
  --bkgd-color:       #000000;
}

/*-- Additional custom styles --*/
/* Add any additional CSS rules below                      */

/* table articles */
d-article table {
    background-color: #040f2d30;
    border-collapse: collapse;
    margin-bottom: 1.5rem;
    border-top: 1px solid rgb(255 255 255);
    border-bottom: 1px solid rgb(255 255 255);
}

/* background of code  */
d-article div.sourceCode {
    background-color: #2a445b;
}

/* floats */
code span.fl {
    color: #05d677;
}

/* logical */
code span.cn {
    color: #ff9a00;
}
/* operators*/
code span.op {
    color: #ffa0a0;
}

/* comment */
code span.co {
    color: #ababab;
}

/* code */
code span.va {
    color: rgb(255 255 255);
}

/* strings */
code span.st {
    color: #f3ff90;
}

/* code */
.sourceCode {
    color: rgb(255 255 255);
    overflow: visible;
}

/* functions */
code span.fu {
    color: #93d0ff;
}

/* links */
a {
    border-bottom: 3px solid #cc0000;
}


/* visited link */
d-article a {
  color: lightblue;
  border-bottom: 3px solid #cc0000;
}


/* mouse over link */
a:hover {
  color: hotpink;
  text-transform: uppercase;
  background-color: #072a469e;
}

/* selected link 
a:active {
  color: blue;
}
*/


.nav-dropdown {
    display: inline-block;
    position: relative;
    border-bottom: 3px solid #cc0000;
}

.nav-dropdown-content a, .nav-dropdown-content .nav-dropdown-header {
    font-size: 14px;
    color: black;
    padding: 6px 24px;
    text-decoration: none;
    display: block;
    text-align: left;
}

.distill-site-header .title {
    padding-left: 0px;
    text-transform: capitalize;
}

@media (min-width: $max-width) {
  .full-width {
    margin-left: calc(50% - 50vw);
    margin-right: calc(50% - 50vw);
  }
}

code {
    white-space: pre;
    color: rgb(255 255 255/65%);
    background-color: rgb(42 68 91);
}

/* Category tags */
.dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgb(255 255 255);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
    background-color: rgb(120 157 175);
}

.nav-dropdown .nav-dropbtn {
    border: none;
    text-transform: lowercase;
    outline: none;
    color: rgba(255, 255, 255, 0.8);
    padding: 16px 10px;
    background-color: transparent;
    font-family: inherit;
    font-size: inherit;
    font-weight: inherit;
    margin: 0;
    margin-top: 1px;
    z-index: 2;
}

.nav-dropdown .nav-dropbtn:hover {
  text-transform: uppercase;
}
</style>
<!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Comparing (Stochastic) Mixed-Effects Tree-Based Models in `{LongituRF}` & `{ranger}`","description":"A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs & Traditional Random Forests.","authors":[{"author":"Christopher Loan","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2021-08-24T00:00:00.000-07:00","citationText":"Loan, 2021"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<header class="header header--fixed" role="banner">
<nav class="distill-site-nav distill-site-header">
<div class="nav-left">
<a class="logo">
<img src="../../images/photo.png" alt="Logo"/>
</a>
<a href="../../index.html" class="title">Christopher Loan's Website</a>
</div>
<div class="nav-right">
<a href="../../index.html">
<i class="fa fa-home" aria-hidden="true"></i>
</a>
<a href="../../blog.html">Blog</a>
<a href="../../about.html">Abbreviated CV</a>
<div class="nav-dropdown">
<button class="nav-dropbtn">
Links to Additional Projects
 
<span class="down-arrow">&#x25BE;</span>
</button>
<div class="nav-dropdown-content">
<a href="https://chhr1s.github.io/GA_DOE_Public/index.html">Inequity FlexDashboard</a>
<a href="https://chhr1s.shinyapps.io/Neural_Net_Predictions/">Shiny App Neural Net (Beta)</a>
<a href="https://chhr1s.shinyapps.io/Loan_Merly_EDLD653_FInal/">Data &amp; Plot Downloader</a>
</div>
</div>
<a href="https://github.com/Chhr1s">
<i class="fa fa-github" aria-hidden="true"></i>
</a>
<a href="https://www.linkedin.com/in/christopher-loan-09965950/">
<i class="fa fa-linkedin" aria-hidden="true"></i>
</a>
<a href="javascript:void(0);" class="nav-toggle">&#9776;</a>
</div>
</nav>
</header>
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Comparing (Stochastic) Mixed-Effects Tree-Based Models in {LongituRF} &amp; {ranger}</h1>
<!--radix_placeholder_categories-->
<!--/radix_placeholder_categories-->
<p><p>A comparison of (S)MERTs, (S)REEMtrees, (S)MERFs &amp; Traditional Random Forests.</p></p>
</div>

<div class="d-byline">
  Christopher Loan  
  
<br/>2021-08-24
</div>

<div class="d-article">
<h1 id="background">Background</h1>
<p>I’m working on a project with my PhD advisor, Dr. Keith Zvoch, which provided multi-wave, nested data. We wanted to make predictions on the data, but hoped to properly model the repeated measures and nested design. After some digging, I found <code>{LongituRF}</code> and the corresponding research paper on the method <a href="https://doi.org/10.1177/0962280220946080">Capitaine (2021)</a>. They introduce the stochastic random effects expectation maximation (SREEM) forest and provide a more general framework for the generalized semi-parametric stochastic mixed-effects model that unites previously proposed related models (i.e., MERTs, MERFs, REEMtrees). It is of note that Capitaine’s (2021) work is all done in a case where the number of predictors &gt;&gt; the number of observations.</p>
<p>Thus, I’ve got two goals in this post:</p>
<ol type="1">
<li>Provide a tutorial on fitting tree-based models with nested, multi-wave structure</li>
<li>Comparing their ability to predict unseen data against one another &amp; against a random forest (RF) from <code>{ranger}</code></li>
</ol>
<h2 id="technical-details">Technical Details</h2>
<p>Here’s their generalized semi-parametric stochastic mixed-effects model, which SREEM forests are an example of the generalized semi-parametric stochastic mixed-effects model:</p>
<p><span class="math inline">\(Yij = f(X_{ij}) + Z_{ij}b_i + ω(t_{ij}) + ε_{ij}\)</span> f = mean behavior function created by a matrix of covariates (<span class="math inline">\(X_{ij}\)</span>) <span class="math inline">\(Z_{ij}\)</span> = vector a covariates associated with a vector of random effects <span class="math inline">\(b_i\)</span> ω = serial correlation modeled as a stochastic process. <span class="math inline">\(ε_{ij}\)</span> = error.</p>
<h3 id="instances-of-generalized-model">Instances of generalized model</h3>
<p>We can modify the terms of the generalized model to get instances of more familiar models with this framework, just like with the generalized linear model and, e.g., regression or t-test:</p>
<p>• decision tree (f estimated by single tree and all predictors, Z = ω = 0) • random forest (f estimated by many trees with subset of predictors, Z = ω = 0) • mixed effects regression tree (f estimated by single tree and all predictors, Z = estimated as linear mixed effects model, ω = 0) • mixed effects random forest (f estimated by many trees with subset of predictors, Z = estimated as linear mixed effects model, ω = 0) • stochastic random effect expectation maximization forest (f estimated by many trees with subset of predictors, Z = estimated as linear mixed effects model, ω = estimated as a stochastic process)</p>
<p>The stochastic random effect is a term used to account for longitudinal data, we can still account for random effects of nesting without estimating serial correlation via the stochastic term. However, Capitaine (2021) showed these models are relatively robust to inappropriate incorporation of such stochasticity.</p>
<p>The difference between the MERT/MERF and REEMtrees/REEMforests is subtle. It comes down to the tree-structure used in the estimation of leaf values; specifically the intra-individual covariance matrix is taken into account in the estimation of leaf values for REEMtrees/REEMforests’ mean behavior function. In MERT/MERF, simple means of leaf values are used instead. This is clearly a benefit in REEMtrees/REEMforests if we have stable strong auto-correlative effect or many waves, but in practice I’ve had more luck with MERFs. This could be a feature of the data I’m working with (only 3 waves, inconsistent auto-correlative effect across schools, etc.); I need to look into this more deeply.</p>
<h3 id="algorithm">Algorithm</h3>
<p>In simple terms, this iterates between estimation of fixed effects and random effects, where fixed effects are estimated in a tree-based model. To be more elaborate:</p>
<p>The algorithm iterates between estimation of unknown model parameters (i.e., Z and ω) and the estimation of the mean behavior function f with an adaptation of the maximum likelihood-based EM algorithm until convergence is reached. Random effects and stochastic process are estimated after computation of an estimated f. </p>
<p>This is done by taking conditional expectations given the data and forming best linear unbiased predictors based on matrix algebra combining the variance matrices, the effects of predictors, and the difference between the observed outcome and the estimated f. Iterating through this process accounts for the intra-individual covariance matrix in the values of terminal nodes.</p>
<p>Take the difference between observed value and random effects estimate (which begins at mean 0 and variance 1, so the first value is the observed value). Then we estimate f for each tree in the forest and estimate leaf values. The product of the function and the estimated values are then averaged. This is used to estimate two functions for all individuals: (1) the stochastic process and (2) the random effects.</p>
<p>Updating those functions results in new values for the variance matrices of the stochastic terms and random effects. If the convergence criterion is not met, the difference between the estimated value and the random effects terms are taken and f is re-estimated, followed by re-estimation of other terms, etc.</p>
<p>Refer to Capitaine (2021) for greater details.</p>
<h2 id="data-used">Data Used</h2>
<p>I often use the Georgia department of Education’s data for examples because it’s in my field and is publicly available. If you want the data, it’s on my <a href="https://github.com/Chhr1s/Distill_Website/tree/main/_blog/running-longitudinal-random-forests-with-longiturf">GitHub for this project</a>. See this <a href="https://chhr1s.github.io/GA_DOE_Public/">flexdashboard</a> of mine for a better understanding of the data, its sources, and some findings.</p>
<p>I did use <code>{mice}</code> for multiple imputation of this data because I wanted as much data as possible to run the model. There are theoretical implications of this that should be considered, but I am presently using this data as a methodological example.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='co'>## I'm doing this for the head() call on the tibble</span>
<span class='fu'><a href='https://rdrr.io/r/base/options.html'>options</a></span><span class='op'>(</span>tibble.width <span class='op'>=</span> <span class='cn'>Inf</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="prepping-the-data">Prepping the Data</h1>
<h2 id="cleaning-data">cleaning data</h2>
<p>I do a few things here, including:</p>
<ul>
<li>make numeric factors for unique districts, schools, and school type (k12, elementary, middle, high school, unreported/other)</li>
<li>only train the model on schools who reported data for each of the first 3 years. I do this because this is an important model for repeated measures data, so I want to focus on that</li>
<li>split data into training (3 years) and testing (1 year)</li>
<li>mean center and scale (with standard-deviation) the data; <strong>NOTE: training and testing scaled separately</strong></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat_2015</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rio</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rio/man/import.html'>import</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>'_blog/running-longitudinal-random-forests-with-longiturf/Imputed Data'</span>, 
      <span class='st'>'year_2015_imputed.csv'</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'>#select(-exclusionary) %&gt;% </span>
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='va'>as.factor</span><span class='op'>)</span>
  
<span class='va'>dat_2016</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rio</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rio/man/import.html'>import</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>'_blog/running-longitudinal-random-forests-with-longiturf/Imputed Data'</span>, 
      <span class='st'>'year_2016_imputed.csv'</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='va'>as.factor</span><span class='op'>)</span>

<span class='va'>dat_2017</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rio</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rio/man/import.html'>import</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>'_blog/running-longitudinal-random-forests-with-longiturf/Imputed Data'</span>, 
      <span class='st'>'year_2017_imputed.csv'</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='va'>as.factor</span><span class='op'>)</span>
  
<span class='va'>dat_2018</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rio</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/rio/man/import.html'>import</a></span><span class='op'>(</span>
    <span class='fu'>here</span><span class='fu'>::</span><span class='fu'><a href='https://here.r-lib.org//reference/here.html'>here</a></span><span class='op'>(</span>
      <span class='st'>'_blog/running-longitudinal-random-forests-with-longiturf/Imputed Data'</span>, 
      <span class='st'>'year_2018_imputed.csv'</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='va'>is.character</span>, <span class='va'>as.factor</span><span class='op'>)</span>

<span class='va'>dat_temp</span> <span class='op'>&lt;-</span> 
  <span class='fu'>bind_rows</span><span class='op'>(</span>
    <span class='va'>dat_2015</span>, 
    <span class='va'>dat_2016</span>, 
    <span class='va'>dat_2017</span>,
    <span class='va'>dat_2018</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>
    school_size <span class='op'>=</span> <span class='va'>total</span>, 
    school_type <span class='op'>=</span> <span class='va'>fac_schtype</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>tibble</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>school_type <span class='op'>=</span> <span class='fu'>na_if</span><span class='op'>(</span><span class='va'>school_type</span>, <span class='st'>""</span><span class='op'>)</span>, 
         year <span class='op'>=</span> <span class='va'>year</span> <span class='op'>-</span> <span class='fl'>2015</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='co'># drop data if schools don't report a school type</span>
  <span class='fu'>drop_na</span><span class='op'>(</span><span class='op'>)</span>

<span class='co'>## setting up the factors so they're unique across all districts etc.</span>
<span class='va'>reference_district</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>district</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>level_district <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>reference_school</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>school_name_unique</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>level_school <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span>

<span class='va'>reference_schtype</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='va'>school_type</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/unique.html'>unique</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>level_schtype <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span><span class='op'>)</span>

<span class='co'>## make sure same labels for training and testing categories</span>

<span class='va'>dat_temp_joined</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat_temp</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>reference_schtype</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>reference_school</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>left_join</span><span class='op'>(</span><span class='va'>reference_district</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>district</span>, <span class='op'>-</span><span class='va'>school_name</span>, <span class='op'>-</span><span class='va'>school_type</span>, <span class='op'>-</span><span class='va'>school_name_unique</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    level_schtype <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>level_schtype</span><span class='op'>)</span>,
    level_school <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>level_school</span><span class='op'>)</span>, 
    level_district <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span><span class='va'>level_district</span><span class='op'>)</span>
    <span class='op'>)</span> 

<span class='va'>train_temp</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat_temp_joined</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>&lt;</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='va'>test</span> <span class='op'>&lt;-</span>
  <span class='va'>dat_temp_joined</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>year</span> <span class='op'>==</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span><span class='op'>(</span><span class='va'>is.factor</span><span class='op'>)</span>, <span class='va'>scale</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>

<span class='co'>## this tells us who was here for 3 years</span>
<span class='va'>three_year_ids</span> <span class='op'>&lt;-</span> 
  <span class='va'>train_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>count</span><span class='op'>(</span><span class='va'>level_school</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>arrange</span><span class='op'>(</span><span class='va'>n</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>n</span> <span class='op'>==</span> <span class='fl'>3</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>level_school</span><span class='op'>)</span>

<span class='va'>dat_years</span> <span class='op'>&lt;-</span> 
  <span class='va'>train_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>three_year_ids</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pull</span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>

<span class='va'>dat</span> <span class='op'>&lt;-</span> 
  <span class='va'>train_temp</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>three_year_ids</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span><span class='op'>-</span><span class='va'>year</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate_if</span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span><span class='op'>(</span><span class='va'>is.factor</span><span class='op'>)</span>, <span class='va'>scale</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>year <span class='op'>=</span> <span class='va'>dat_years</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="explaining-the-data">Explaining the Data</h2>
<p>To walk you through the data a bit, anything with <code>perc_</code> is a school level percent variable and anything with <code>d_</code> is a district percent (made by aggregating the school percents). <code>school_type</code> refers to elementary, middle, high school, or K-12.</p>
<p>The outcome we’re interested in is number of exclusionary punishments. These are more or less any punishments which remove a student from the school.</p>
<p>The other variables should be common sense by the name; again, see this <a href="https://chhr1s.github.io/GA_DOE_Public/">flexdashboard</a> for more information.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='fl'>3</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 3 x 20
  school_size[,1] perc_frl[,1] perc_black[,1] perc_hisp[,1]
            &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;
1          0.405        -0.134         -0.530       -0.145 
2         -0.343         0.571         -0.296        0.404 
3         -0.0124        0.119         -0.530       -0.0765
  perc_white[,1] perc_migrant[,1] perc_esol[,1] exclusionary[,1]
           &lt;dbl&gt;            &lt;dbl&gt;         &lt;dbl&gt;            &lt;dbl&gt;
1          0.747             3.06        -0.426          -0.0436
2          0.161             5.53         0.360          -0.529 
3          0.678             3.06        -0.416          -0.393 
  exclusionary_ps[,1] district_size[,1] d_black[,1] d_hisp[,1]
                &lt;dbl&gt;             &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;
1              -0.149            -0.803      -0.648     0.0712
2              -0.394            -0.803      -0.648     0.0712
3              -0.313            -0.803      -0.648     0.0712
  d_white[,1] d_esol[,1] d_migrant[,1] d_frl[,1] level_schtype
        &lt;dbl&gt;      &lt;dbl&gt;         &lt;dbl&gt;     &lt;dbl&gt; &lt;fct&gt;        
1       0.758      0.292          5.16     0.436 1            
2       0.758      0.292          5.16     0.436 2            
3       0.758      0.292          5.16     0.436 3            
  level_school level_district  year
  &lt;fct&gt;        &lt;fct&gt;          &lt;dbl&gt;
1 1            1                  0
2 2            1                  0
3 3            1                  0</code></pre>
</div>
<h2 id="organizing-the-data">organizing the data</h2>
<p>The model likes getting data in a specific way. I am not a big fan of the specification; I decided to make a list that had the same structure as the list from the <code>DataLongGenerator()</code> within the package. The list below has the appropriate structure. I explained all of the components in comments to make it clear.</p>
<h3 id="train-data">Train Data</h3>
<p>From the years = 1 - 3 (i.e., 2015-2017).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>X</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span>
    <span class='op'>-</span><span class='va'>year</span>,
    <span class='op'>-</span><span class='va'>exclusionary</span>, 
    <span class='op'>-</span><span class='va'>exclusionary_ps</span>,
    <span class='op'>-</span><span class='va'>level_district</span>,
    <span class='op'>-</span><span class='va'>level_school</span>,
    <span class='va'>district_size</span>
    <span class='op'>)</span> 

<span class='va'>list_dat</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='co'># predictors, level1 and level2</span>
    X <span class='op'>=</span> <span class='va'>X</span>, 
    <span class='co'># outcome</span>
    Y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>pull</span><span class='op'>(</span><span class='va'>dat</span>, <span class='va'>exclusionary</span><span class='op'>)</span><span class='op'>)</span>, 
    <span class='co'># id variables for each unique school</span>
    id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>pull</span><span class='op'>(</span><span class='va'>dat</span>, <span class='va'>level_school</span><span class='op'>)</span><span class='op'>)</span>, 
    <span class='co'># random effects (I'm using only a random intercept)</span>
    Z <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>dat</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>, 
    <span class='co'># years where wave 1 = 0, wave 2 = 1, wave 3 = 2</span>
    time <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='fu'>pull</span><span class='op'>(</span><span class='va'>dat</span>, <span class='va'>year</span><span class='op'>)</span><span class='op'>)</span> 
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="running-the-models">Running the Models</h1>
<p>In all of these examples, I’ll provide you with the amount of time this took me to run (in seconds). I also am using all default settings. I’ve commented these out to show you the settings and how to specify it.</p>
<p>For each of the models, I’ve run the Ornstein–Uhlenbeck stochastic process. I chose this because it essentially pulls estimates back to their mean. This seems intuitive to me, as perhaps, the student composition changes yearly, but faculty and staff may be there acting similarly.</p>
<h2 id="load-package">load package</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>LongituRF</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="mert">MERT</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>start_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>mert1</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/LongituRF/man/MERT.html'>MERT</a></span><span class='op'>(</span>
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_dat</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    Y <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Y</span>,
    id <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>time</span>,
    sto <span class='op'>=</span> <span class='st'>'OrnUhl'</span>, <span class='co'># Ornstein–Uhlenbeck</span>
    <span class='co'>#iter = 100, </span>
    <span class='co'>#delta = 0.001</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>[1] &quot;stopped after 4 iterations.&quot;</code></pre>
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>stop_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>run_time</span> <span class='op'>&lt;-</span> <span class='va'>stop_time</span> <span class='op'>-</span> <span class='va'>start_time</span>
</code></pre>
</div>
</details>
</div>
<p>Here’s the run time for that model:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>run_time</span>
</code></pre>
</div>
</details>
<pre><code>   user  system elapsed 
  9.483   1.556  11.077 </code></pre>
</div>
<h2 id="reemtree">REEMtree</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>start_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>reemtree1</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/LongituRF/man/REEMtree.html'>REEMtree</a></span><span class='op'>(</span>
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_dat</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    Y <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Y</span>,
    id <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>time</span>,
    sto <span class='op'>=</span> <span class='st'>'OrnUhl'</span>,
    <span class='co'>#iter = 100,</span>
    <span class='co'>#delta = 0.001</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>[1] &quot;stopped after 4 iterations.&quot;</code></pre>
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>stop_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>run_time</span> <span class='op'>&lt;-</span> <span class='va'>stop_time</span> <span class='op'>-</span> <span class='va'>start_time</span>
</code></pre>
</div>
</details>
</div>
<p>Here’s the run time for that model:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>run_time</span>
</code></pre>
</div>
</details>
<pre><code>   user  system elapsed 
 11.940   1.864  13.934 </code></pre>
</div>
<h2 id="merf">MERF</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>start_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>merf1</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/LongituRF/man/MERF.html'>MERF</a></span><span class='op'>(</span>
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_dat</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    Y <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Y</span>,
    id <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_dat</span><span class='op'>$</span><span class='va'>time</span>,
    sto <span class='op'>=</span> <span class='st'>'OrnUhl'</span>,
    <span class='co'>#iter = 100,</span>
    <span class='co'>#delta = 0.001</span>
    <span class='co'>#mtry = ceiling(ncol(data.frame(list_dat$X))/3),</span>
    <span class='co'>#ntree = 500</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code>[1] &quot;stopped after 33 iterations.&quot;</code></pre>
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>stop_time</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/proc.time.html'>proc.time</a></span><span class='op'>(</span><span class='op'>)</span>
<span class='va'>run_time</span> <span class='op'>&lt;-</span> <span class='va'>stop_time</span> <span class='op'>-</span> <span class='va'>start_time</span>
</code></pre>
</div>
</details>
</div>
<p>Here’s the run time for that model:</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>run_time</span>
</code></pre>
</div>
</details>
<pre><code>   user  system elapsed 
1121.49   43.58 1168.78 </code></pre>
</div>
<p>I’ll say here that (S)REEMforest had a lot of trouble converging for me. From the limited trouble shooting I did on the matter, it appears that the issue with the (S)REEMforest is in its estimation of random effects and/or their predictors. Even with an intercept-only model and no stochastic term, I couldn’t consistently get convergence. Admittedly, this could be an issue with the random effects just for my data; however, if that were the case, I’d expect MERF to have issues as well. I’ll make a post on this if I figure it out.</p>
<h2 id="making-predictions-on-unseen-data">Making Predictions on Unseen Data</h2>
<h3 id="prep-test-data">Prep Test Data</h3>
<p>From the year = 3 (i.e., 2018). Notice that in this step I’m filtering out cases that were observed before. With these cases, we can predict with fixed and random effects. We’ll need to make a function to predict the whole data set, using just the fixed effects to predict cases that we haven’t seen before (i.e., schools who didn’t report before 2018)</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>X_test</span> <span class='op'>&lt;-</span> 
  <span class='va'>test</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>merf1</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>select</span><span class='op'>(</span>
    <span class='op'>-</span><span class='va'>year</span>,
    <span class='op'>-</span><span class='va'>exclusionary</span>, 
    <span class='op'>-</span><span class='va'>exclusionary_ps</span>,
    <span class='op'>-</span><span class='va'>level_district</span>,
    <span class='op'>-</span><span class='va'>level_school</span>,
    <span class='va'>district_size</span>
    <span class='op'>)</span>

<span class='va'>list_test</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    X <span class='op'>=</span> <span class='va'>X_test</span>,
    Y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>test</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>merf1</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>exclusionary</span><span class='op'>)</span><span class='op'>)</span>,
    id <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span><span class='op'>(</span><span class='va'>test</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>merf1</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>level_school</span><span class='op'>)</span><span class='op'>)</span>,
    Z <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/matrix.html'>as.matrix</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>test</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>, 
    time <span class='op'>=</span> <span class='va'>test</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>level_school</span> <span class='op'>%in%</span> <span class='va'>merf1</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>pull</span><span class='op'>(</span><span class='va'>year</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>The native prediction function from <code>LongituRF</code> removed the predictions for cases that weren’t observed in the data (i.e., schools which didn’t report data before 2018). For that reason, I made the <code>fixed_prediction_function()</code> (below) that creates a data frame of predictions for all cases. The way we predict cases that are new is simply with the fixed effects.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fixed_prediction_function</span> <span class='op'>&lt;-</span> 
  <span class='kw'>function</span><span class='op'>(</span><span class='va'>object</span>, <span class='va'>X</span>, <span class='va'>id</span>, <span class='va'>Z</span>, <span class='va'>time</span>, <span class='va'>new_df</span>, <span class='va'>id_var_name</span>, <span class='va'>...</span><span class='op'>)</span>
  <span class='op'>{</span>
  <span class='va'>`%notin%`</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/funprog.html'>Negate</a></span><span class='op'>(</span><span class='va'>`%in%`</span><span class='op'>)</span>
  <span class='kw'>if</span><span class='op'>(</span><span class='st'>"tidyverse"</span> <span class='op'>%notin%</span> <span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/zpackages.html'>.packages</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/message.html'>suppressMessages</a></span><span class='op'>(</span><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span><span class='op'>)</span><span class='op'>}</span>
  
  <span class='va'>preds_existing</span> <span class='op'>&lt;-</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>
      object <span class='op'>=</span> <span class='va'>object</span>,
      X <span class='op'>=</span> <span class='va'>X</span>,
      id <span class='op'>=</span> <span class='va'>id</span>,
      Z <span class='op'>=</span> <span class='va'>Z</span>,
      time <span class='op'>=</span> <span class='va'>time</span>
      <span class='op'>)</span>
  
  <span class='va'>temp</span> <span class='op'>&lt;-</span> 
    <span class='va'>new_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span><span class='va'>id_var_name</span><span class='op'>}</span><span class='op'>}</span> <span class='op'>%notin%</span> <span class='va'>object</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>predictions <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span>object <span class='op'>=</span> <span class='va'>object</span><span class='op'>$</span><span class='va'>forest</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span><span class='op'>)</span>
  
  <span class='va'>final_df</span> <span class='op'>&lt;-</span> 
    <span class='va'>new_df</span> <span class='op'>%&gt;%</span> 
    <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='op'>{</span><span class='op'>{</span><span class='va'>id_var_name</span><span class='op'>}</span><span class='op'>}</span> <span class='op'>%in%</span> <span class='va'>object</span><span class='op'>$</span><span class='va'>id</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>mutate</span><span class='op'>(</span>predictions <span class='op'>=</span> <span class='va'>preds_existing</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>bind_rows</span><span class='op'>(</span><span class='va'>temp</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
    <span class='fu'>select</span><span class='op'>(</span><span class='va'>level_school</span>, <span class='va'>predictions</span><span class='op'>)</span>
  <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>final_df</span><span class='op'>)</span>
<span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<p>I obtain predictions for each of the three <code>LongituRF</code> based models (the (S)MERT, (S)REEMtree, and the (S)MERF). Again, I had difficulty with convergence on the (S)REEMforest, so I omitted it.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>predictions_mert_df</span> <span class='op'>&lt;-</span> 
  <span class='fu'>fixed_prediction_function</span><span class='op'>(</span>
    object <span class='op'>=</span> <span class='va'>mert1</span>,
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_test</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    id <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>time</span>, 
    new_df <span class='op'>=</span> <span class='va'>test</span>,
    id_var_name <span class='op'>=</span> <span class='va'>level_school</span>,
    <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>predictions_reemtree_df</span> <span class='op'>&lt;-</span> 
  <span class='fu'>fixed_prediction_function</span><span class='op'>(</span>
    object <span class='op'>=</span> <span class='va'>reemtree1</span>,
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_test</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    id <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>time</span>, 
    new_df <span class='op'>=</span> <span class='va'>test</span>, 
    id_var_name <span class='op'>=</span> <span class='va'>level_school</span>,
    <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>predictions_merf_df</span> <span class='op'>&lt;-</span> 
  <span class='fu'>fixed_prediction_function</span><span class='op'>(</span>
    object <span class='op'>=</span> <span class='va'>merf1</span>,
    X <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_test</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span>,
    id <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>id</span>,
    Z <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>Z</span>,
    time <span class='op'>=</span> <span class='va'>list_test</span><span class='op'>$</span><span class='va'>time</span>, 
    new_df <span class='op'>=</span> <span class='va'>test</span>, 
    id_var_name <span class='op'>=</span> <span class='va'>level_school</span>,
    <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="fit-a-random-forest-with-ranger">Fit a Random Forest with <code>{ranger}</code></h1>
<p>First I’ll remove the <code>{LongituRF}</code> package and load <code>{ranger}</code>.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/detach.html'>detach</a></span><span class='op'>(</span><span class='st'>"package:LongituRF"</span>, unload<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> 
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://github.com/imbs-hl/ranger'>ranger</a></span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<p>Now I’ll fit the model and obtain predictions on test data. Because I can’t specify time or id for the nested observation, I’m just putting them in as factors predicting the outcome in the random forest. <code>{ranger}</code> is able to work with factors with large levels easily and I don’t want to keep information away from the random forest when making a comparison. I want to use the same number of trees in <code>mtry</code> across functions, so I’m switching the <code>{ranger}</code> default to the same number used in the MERF (<code>ceiling(ncol(data.frame(list_dat$X))/3)</code> = 5). The ranger default would have used <code>mtry = 4</code> with the formula we used.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>rf1</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/ranger/man/ranger.html'>ranger</a></span><span class='op'>(</span>
    formula <span class='op'>=</span> 
      <span class='va'>exclusionary</span> <span class='op'>~</span> 
        <span class='va'>d_black</span> <span class='op'>+</span>
        <span class='va'>d_hisp</span> <span class='op'>+</span>
        <span class='va'>d_white</span> <span class='op'>+</span>
        <span class='va'>d_migrant</span> <span class='op'>+</span>
        <span class='va'>d_frl</span> <span class='op'>+</span>
        <span class='va'>d_esol</span> <span class='op'>+</span>
        <span class='va'>perc_black</span> <span class='op'>+</span>
        <span class='va'>perc_frl</span> <span class='op'>+</span>
        <span class='va'>perc_hisp</span> <span class='op'>+</span>
        <span class='va'>perc_white</span> <span class='op'>+</span>
        <span class='va'>perc_migrant</span> <span class='op'>+</span>
        <span class='va'>perc_esol</span> <span class='op'>+</span>
        <span class='va'>school_size</span> <span class='op'>+</span>
        <span class='va'>district_size</span> <span class='op'>+</span>
        <span class='va'>level_schtype</span> <span class='op'>+</span> 
        <span class='va'>year</span> <span class='op'>+</span>
        <span class='va'>level_school</span>, 
    mtry <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>ceiling</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='va'>list_dat</span><span class='op'>$</span><span class='va'>X</span><span class='op'>)</span><span class='op'>)</span><span class='op'>/</span><span class='fl'>3</span><span class='op'>)</span>,
    importance <span class='op'>=</span> <span class='st'>'permutation'</span>,
    data <span class='op'>=</span> <span class='va'>dat</span>
    <span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>predictions_rf</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>rf1</span>, data <span class='op'>=</span> <span class='va'>test</span><span class='op'>)</span><span class='op'>$</span><span class='va'>predictions</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='kw'><a href='https://rdrr.io/r/base/detach.html'>detach</a></span><span class='op'>(</span><span class='st'>"package:ranger"</span>, unload<span class='op'>=</span><span class='cn'>TRUE</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<h1 id="fit-of-data">Fit of Data</h1>
<h2 id="actual-vs.-observed-data">Actual vs. Observed Data</h2>
<p>Here’s the scaled actual exclusionary punishments (y-axis) compared to the predctions for each model (x-axis).</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>test_trees</span> <span class='op'>&lt;-</span> 
  <span class='va'>test</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>
    predictions_rf <span class='op'>=</span> <span class='va'>predictions_rf</span>, 
    diff_rf <span class='op'>=</span> <span class='va'>predictions_rf</span> <span class='op'>-</span> <span class='va'>exclusionary</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>predictions_merf_df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>predictions_merf <span class='op'>=</span> <span class='va'>predictions</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>diff_merf <span class='op'>=</span> <span class='va'>predictions_merf</span> <span class='op'>-</span> <span class='va'>exclusionary</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>predictions_mert_df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>predictions_mert <span class='op'>=</span> <span class='va'>predictions</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>diff_mert <span class='op'>=</span> <span class='va'>predictions_mert</span> <span class='op'>-</span> <span class='va'>exclusionary</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>inner_join</span><span class='op'>(</span><span class='va'>predictions_reemtree_df</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>rename</span><span class='op'>(</span>predictions_reemtree <span class='op'>=</span> <span class='va'>predictions</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>mutate</span><span class='op'>(</span>diff_reemtree <span class='op'>=</span> <span class='va'>predictions_reemtree</span> <span class='op'>-</span> <span class='va'>exclusionary</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>test_trees</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='va'>predictions_rf</span><span class='op'>:</span><span class='va'>diff_reemtree</span>,
    names_sep <span class='op'>=</span> <span class='st'>'_'</span>, 
    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'statistic'</span>, <span class='st'>'model'</span><span class='op'>)</span>, 
    values_to <span class='op'>=</span> <span class='st'>'prediction'</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>statistic</span> <span class='op'>==</span> <span class='st'>'predictions'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>prediction</span>, y <span class='op'>=</span> <span class='va'>exclusionary</span>, color <span class='op'>=</span> <span class='va'>model</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_point</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.4</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>lims</span><span class='op'>(</span>x <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>,<span class='fl'>9</span><span class='op'>)</span>, y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>1</span>, <span class='fl'>9</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_abline</span><span class='op'>(</span>intercept <span class='op'>=</span> <span class='fl'>0</span>, slope <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>facet_wrap</span><span class='op'>(</span><span class='op'>~</span><span class='va'>model</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-25-1.png" width="624" /></p>
</div>
<h2 id="mean-absolute-error-mae">Mean Absolute Error (MAE)</h2>
<p>The models all have fairly similar MAE (ours are in standard deviation units), with MERFs being the best and traditional random forests being the worst.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>test_trees</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>pivot_longer</span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='va'>predictions_rf</span><span class='op'>:</span><span class='va'>diff_reemtree</span>,
    names_sep <span class='op'>=</span> <span class='st'>'_'</span>, 
    names_to <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'statistic'</span>, <span class='st'>'model'</span><span class='op'>)</span>, 
    values_to <span class='op'>=</span> <span class='st'>'prediction'</span>
    <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/filter.html'>filter</a></span><span class='op'>(</span><span class='va'>statistic</span> <span class='op'>==</span> <span class='st'>'diff'</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>group_by</span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>summarize</span><span class='op'>(</span>mae <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>abs</a></span><span class='op'>(</span><span class='va'>prediction</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='fu'>aes</span><span class='op'>(</span>fill <span class='op'>=</span> <span class='va'>model</span>, y <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>mae</span><span class='op'>)</span>, x <span class='op'>=</span> <span class='va'>mae</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>geom_col</span><span class='op'>(</span>alpha <span class='op'>=</span> <span class='fl'>0.4</span>, show.legend <span class='op'>=</span> <span class='cn'>F</span>, color <span class='op'>=</span> <span class='st'>'black'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    x <span class='op'>=</span> <span class='st'>'Mean Absolute Error'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme_minimal</span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>colorblindr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/colorblindr/man/scale_OkabeIto.html'>scale_fill_OkabeIto</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>plot.title.position <span class='op'>=</span> <span class='st'>'plot'</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>y <span class='op'>=</span> <span class='st'>'model'</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-26-1.png" width="624" /></p>
</div>
<p>This improvement is with a process that has a relatively small variance in the random intercept. I could imagine this being more important as there is more variance in the random effects or if the models had different .</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>
  Rand_Int_Variance <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>mert1</span><span class='op'>$</span><span class='va'>var_random_effects</span>, <span class='va'>reemtree1</span><span class='op'>$</span><span class='va'>var_random_effects</span>, <span class='va'>merf1</span><span class='op'>$</span><span class='va'>var_random_effects</span><span class='op'>)</span>,
  model <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'MERT'</span>, <span class='st'>'REEMtree'</span>, <span class='st'>'MERF'</span><span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 3 x 2
  Rand_Int_Variance model   
              &lt;dbl&gt; &lt;chr&gt;   
1             0.206 MERT    
2             0.218 REEMtree
3             0.205 MERF    </code></pre>
</div>
<h2 id="variable-importance-plots">Variable Importance Plots</h2>
<p>I’ve printed the variable importance plots for each method. I have removed the x-axis to prevent people from trying to draw conclusions across models’ axes. We can see that the models are pulling out theoretically relevant variables and similar variables across the models.</p>
<p>Interestingly, the MERF gave much greater weight to the variables that are theoretically relevant, compared to those with lesser theoretical impact.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>
  variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>rf1</span><span class='op'>$</span><span class='va'>variable.importance</span><span class='op'>)</span>, 
  importance <span class='op'>=</span> <span class='va'>rf1</span><span class='op'>$</span><span class='va'>variable.importance</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_col</span><span class='op'>(</span>
    <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variables</span>, <span class='va'>importance</span><span class='op'>)</span>, 
        x <span class='op'>=</span> <span class='va'>importance</span><span class='op'>)</span>,
    fill <span class='op'>=</span> <span class='st'>'cornflowerblue'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>,
    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'Random Forest'</span>, 
    y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-28-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>
  variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>mert1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>variable.importance</span><span class='op'>)</span>, 
  importance <span class='op'>=</span> <span class='va'>mert1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>variable.importance</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_col</span><span class='op'>(</span>
    <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variables</span>, <span class='va'>importance</span><span class='op'>)</span>, 
        x <span class='op'>=</span> <span class='va'>importance</span><span class='op'>)</span>,
    fill <span class='op'>=</span> <span class='st'>'coral3'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>,
    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'MERT'</span>, 
    y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-29-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>
  variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>reemtree1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>variable.importance</span><span class='op'>)</span>, 
  importance <span class='op'>=</span> <span class='va'>reemtree1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>variable.importance</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_col</span><span class='op'>(</span>
    <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variables</span>, <span class='va'>importance</span><span class='op'>)</span>, 
        x <span class='op'>=</span> <span class='va'>importance</span><span class='op'>)</span>,
    fill <span class='op'>=</span> <span class='st'>'orange'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>,
    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'REEMtree'</span>, 
    y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-30-1.png" width="624" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'>tibble</span><span class='op'>(</span>
  variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/names.html'>names</a></span><span class='op'>(</span><span class='va'>merf1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>importance</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span><span class='op'>)</span>, 
  importance <span class='op'>=</span> <span class='va'>merf1</span><span class='op'>$</span><span class='va'>forest</span><span class='op'>$</span><span class='va'>importance</span><span class='op'>[</span>,<span class='fl'>1</span><span class='op'>]</span>
  <span class='op'>)</span> <span class='op'>%&gt;%</span> 
  <span class='fu'>ggplot</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'>geom_col</span><span class='op'>(</span>
    <span class='fu'>aes</span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'>fct_reorder</span><span class='op'>(</span><span class='va'>variables</span>, <span class='va'>importance</span><span class='op'>)</span>, 
        x <span class='op'>=</span> <span class='va'>importance</span><span class='op'>)</span>,
    fill <span class='op'>=</span> <span class='st'>'darkgreen'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>,
    show.legend <span class='op'>=</span> <span class='cn'>FALSE</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>labs</span><span class='op'>(</span>
    title <span class='op'>=</span> <span class='st'>'MERF'</span>, 
    y <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
    <span class='fu'>theme_minimal</span><span class='op'>(</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'>theme</span><span class='op'>(</span>axis.text.x <span class='op'>=</span> <span class='fu'>element_blank</span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<p><img src="running-longitudinal-random-forests-with-longiturf_files/figure-html5/unnamed-chunk-31-1.png" width="624" /></p>
</div>
<div class="sourceCode" id="cb9"><pre class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
