<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">

<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"/>
  <meta name="generator" content="distill" />

  <style type="text/css">
  /* Hide doc at startup (prevent jankiness while JS renders/transforms) */
  body {
    visibility: hidden;
  }
  </style>

 <!--radix_placeholder_import_source-->
 <!--/radix_placeholder_import_source-->

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ad0000; } /* Alert */
code span.an { color: #5e5e5e; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #ad0000; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007ba5; } /* ControlFlow */
code span.ch { color: #20794d; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #5e5e5e; } /* Comment */
code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
code span.dt { color: #ad0000; } /* DataType */
code span.dv { color: #ad0000; } /* DecVal */
code span.er { color: #ad0000; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #ad0000; } /* Float */
code span.fu { color: #4758ab; } /* Function */
code span.im { } /* Import */
code span.in { color: #5e5e5e; } /* Information */
code span.kw { color: #007ba5; } /* Keyword */
code span.op { color: #5e5e5e; } /* Operator */
code span.ot { color: #007ba5; } /* Other */
code span.pp { color: #ad0000; } /* Preprocessor */
code span.sc { color: #5e5e5e; } /* SpecialChar */
code span.ss { color: #20794d; } /* SpecialString */
code span.st { color: #20794d; } /* String */
code span.va { color: #111111; } /* Variable */
code span.vs { color: #20794d; } /* VerbatimString */
code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
</style>


  <!--radix_placeholder_meta_tags-->
  <title>Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning</title>

  <meta property="description" itemprop="description" content="A simulation study to demonstrate the ability of model-based recursive partitioning to identify differential effects in a regression discontinuity design (RDD)."/>


  <!--  https://schema.org/Article -->
  <meta property="article:published" itemprop="datePublished" content="2022-03-06"/>
  <meta property="article:created" itemprop="dateCreated" content="2022-03-06"/>
  <meta name="article:author" content="Christopher Loan"/>

  <!--  https://developers.facebook.com/docs/sharing/webmasters#markup -->
  <meta property="og:title" content="Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning"/>
  <meta property="og:type" content="article"/>
  <meta property="og:description" content="A simulation study to demonstrate the ability of model-based recursive partitioning to identify differential effects in a regression discontinuity design (RDD)."/>
  <meta property="og:locale" content="en_US"/>

  <!--  https://dev.twitter.com/cards/types/summary -->
  <meta property="twitter:card" content="summary"/>
  <meta property="twitter:title" content="Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning"/>
  <meta property="twitter:description" content="A simulation study to demonstrate the ability of model-based recursive partitioning to identify differential effects in a regression discontinuity design (RDD)."/>

  <!--/radix_placeholder_meta_tags-->
  <!--radix_placeholder_rmarkdown_metadata-->

  <script type="text/json" id="radix-rmarkdown-metadata">
  {"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["title","description","author","date","categories","output","draft"]}},"value":[{"type":"character","attributes":{},"value":["Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning"]},{"type":"character","attributes":{},"value":["A simulation study to demonstrate the ability of model-based recursive partitioning to identify differential effects in a regression discontinuity design (RDD).\n"]},{"type":"list","attributes":{},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["name"]}},"value":[{"type":"character","attributes":{},"value":["Christopher Loan"]}]}]},{"type":"character","attributes":{},"value":["2022-03-06"]},{"type":"character","attributes":{},"value":["Model-Based Recursive Partitioning","Machine Learning","Plotting","Simulated Data"]},{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["distill::distill_article"]}},"value":[{"type":"list","attributes":{"names":{"type":"character","attributes":{},"value":["self_contained","code_folding","toc","toc_float"]}},"value":[{"type":"logical","attributes":{},"value":[false]},{"type":"character","attributes":{},"value":["show code"]},{"type":"logical","attributes":{},"value":[true]},{"type":"logical","attributes":{},"value":[true]}]}]},{"type":"logical","attributes":{},"value":[false]}]}
  </script>
  <!--/radix_placeholder_rmarkdown_metadata-->
  
  <script type="text/json" id="radix-resource-manifest">
  {"type":"character","attributes":{},"value":["identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/anchor-4.2.2/anchor.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/bowser-1.9.3/bowser.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/distill-2.2.21/template.v2.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-16-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-17-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-18-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-19-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-20-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-21-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-22-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-23-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-26-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-27-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-5-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-6-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-7-1.png","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/header-attrs-2.11/header-attrs.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/AUTHORS.txt","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-1.12.4.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-1.12.4.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-1.12.4.min.map","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-2.2.4.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-2.2.4.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-2.2.4.min.map","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-3.5.1.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-3.5.1.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-3.5.1.min.map","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/LICENSE.txt","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/popper-2.6.0/popper.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy-bundle.umd.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy-light-border.css","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy.css","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy.umd.min.js","identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/webcomponents-2.0.0/webcomponents.js"]}
  </script>
  <!--radix_placeholder_navigation_in_header-->
  <!--/radix_placeholder_navigation_in_header-->
  <!--radix_placeholder_distill-->

  <style type="text/css">

  body {
    background-color: white;
  }

  .pandoc-table {
    width: 100%;
  }

  .pandoc-table>caption {
    margin-bottom: 10px;
  }

  .pandoc-table th:not([align]) {
    text-align: left;
  }

  .pagedtable-footer {
    font-size: 15px;
  }

  d-byline .byline {
    grid-template-columns: 2fr 2fr;
  }

  d-byline .byline h3 {
    margin-block-start: 1.5em;
  }

  d-byline .byline .authors-affiliations h3 {
    margin-block-start: 0.5em;
  }

  .authors-affiliations .orcid-id {
    width: 16px;
    height:16px;
    margin-left: 4px;
    margin-right: 4px;
    vertical-align: middle;
    padding-bottom: 2px;
  }

  d-title .dt-tags {
    margin-top: 1em;
    grid-column: text;
  }

  .dt-tags .dt-tag {
    text-decoration: none;
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0em 0.4em;
    margin-right: 0.5em;
    margin-bottom: 0.4em;
    font-size: 70%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  d-article table.gt_table td,
  d-article table.gt_table th {
    border-bottom: none;
  }

  .html-widget {
    margin-bottom: 2.0em;
  }

  .l-screen-inset {
    padding-right: 16px;
  }

  .l-screen .caption {
    margin-left: 10px;
  }

  .shaded {
    background: rgb(247, 247, 247);
    padding-top: 20px;
    padding-bottom: 20px;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .html-widget {
    margin-bottom: 0;
    border: 1px solid rgba(0, 0, 0, 0.1);
  }

  .shaded .shaded-content {
    background: white;
  }

  .text-output {
    margin-top: 0;
    line-height: 1.5em;
  }

  .hidden {
    display: none !important;
  }

  d-article {
    padding-top: 2.5rem;
    padding-bottom: 30px;
  }

  d-appendix {
    padding-top: 30px;
  }

  d-article>p>img {
    width: 100%;
  }

  d-article h2 {
    margin: 1rem 0 1.5rem 0;
  }

  d-article h3 {
    margin-top: 1.5rem;
  }

  d-article iframe {
    border: 1px solid rgba(0, 0, 0, 0.1);
    margin-bottom: 2.0em;
    width: 100%;
  }

  /* Tweak code blocks */

  d-article div.sourceCode code,
  d-article pre code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: auto;
  }

  d-article div.sourceCode {
    background-color: white;
  }

  d-article div.sourceCode pre {
    padding-left: 10px;
    font-size: 12px;
    border-left: 2px solid rgba(0,0,0,0.1);
  }

  d-article pre {
    font-size: 12px;
    color: black;
    background: none;
    margin-top: 0;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  d-article pre a {
    border-bottom: none;
  }

  d-article pre a:hover {
    border-bottom: none;
    text-decoration: underline;
  }

  d-article details {
    grid-column: text;
    margin-bottom: 0.8em;
  }

  @media(min-width: 768px) {

  d-article pre,
  d-article div.sourceCode,
  d-article div.sourceCode pre {
    overflow: visible !important;
  }

  d-article div.sourceCode pre {
    padding-left: 18px;
    font-size: 14px;
  }

  d-article pre {
    font-size: 14px;
  }

  }

  figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  /* CSS for d-contents */

  .d-contents {
    grid-column: text;
    color: rgba(0,0,0,0.8);
    font-size: 0.9em;
    padding-bottom: 1em;
    margin-bottom: 1em;
    padding-bottom: 0.5em;
    margin-bottom: 1em;
    padding-left: 0.25em;
    justify-self: start;
  }

  @media(min-width: 1000px) {
    .d-contents.d-contents-float {
      height: 0;
      grid-column-start: 1;
      grid-column-end: 4;
      justify-self: center;
      padding-right: 3em;
      padding-left: 2em;
    }
  }

  .d-contents nav h3 {
    font-size: 18px;
    margin-top: 0;
    margin-bottom: 1em;
  }

  .d-contents li {
    list-style-type: none
  }

  .d-contents nav > ul {
    padding-left: 0;
  }

  .d-contents ul {
    padding-left: 1em
  }

  .d-contents nav ul li {
    margin-top: 0.6em;
    margin-bottom: 0.2em;
  }

  .d-contents nav a {
    font-size: 13px;
    border-bottom: none;
    text-decoration: none
    color: rgba(0, 0, 0, 0.8);
  }

  .d-contents nav a:hover {
    text-decoration: underline solid rgba(0, 0, 0, 0.6)
  }

  .d-contents nav > ul > li > a {
    font-weight: 600;
  }

  .d-contents nav > ul > li > ul {
    font-weight: inherit;
  }

  .d-contents nav > ul > li > ul > li {
    margin-top: 0.2em;
  }


  .d-contents nav ul {
    margin-top: 0;
    margin-bottom: 0.25em;
  }

  .d-article-with-toc h2:nth-child(2) {
    margin-top: 0;
  }


  /* Figure */

  .figure {
    position: relative;
    margin-bottom: 2.5em;
    margin-top: 1.5em;
  }

  .figure img {
    width: 100%;
  }

  .figure .caption {
    color: rgba(0, 0, 0, 0.6);
    font-size: 12px;
    line-height: 1.5em;
  }

  .figure img.external {
    background: white;
    border: 1px solid rgba(0, 0, 0, 0.1);
    box-shadow: 0 1px 8px rgba(0, 0, 0, 0.1);
    padding: 18px;
    box-sizing: border-box;
  }

  .figure .caption a {
    color: rgba(0, 0, 0, 0.6);
  }

  .figure .caption b,
  .figure .caption strong, {
    font-weight: 600;
    color: rgba(0, 0, 0, 1.0);
  }

  /* Citations */

  d-article .citation {
    color: inherit;
    cursor: inherit;
  }

  div.hanging-indent{
    margin-left: 1em; text-indent: -1em;
  }

  /* Citation hover box */

  .tippy-box[data-theme~=light-border] {
    background-color: rgba(250, 250, 250, 0.95);
  }

  .tippy-content > p {
    margin-bottom: 0;
    padding: 2px;
  }


  /* Tweak 1000px media break to show more text */

  @media(min-width: 1000px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 80px [middle-start] 50px [text-start kicker-end] 65px 65px 65px 65px 65px 65px 65px 65px [text-end gutter-start] 65px [middle-end] 65px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 16px;
    }

    .grid {
      grid-column-gap: 16px;
    }

    d-article {
      font-size: 1.06rem;
      line-height: 1.7em;
    }
    figure .caption, .figure .caption, figure figcaption {
      font-size: 13px;
    }
  }

  @media(min-width: 1180px) {
    .base-grid,
    distill-header,
    d-title,
    d-abstract,
    d-article,
    d-appendix,
    distill-appendix,
    d-byline,
    d-footnote-list,
    d-citation-list,
    distill-footer {
      grid-template-columns: [screen-start] 1fr [page-start kicker-start] 60px [middle-start] 60px [text-start kicker-end] 60px 60px 60px 60px 60px 60px 60px 60px [text-end gutter-start] 60px [middle-end] 60px [page-end gutter-end] 1fr [screen-end];
      grid-column-gap: 32px;
    }

    .grid {
      grid-column-gap: 32px;
    }
  }


  /* Get the citation styles for the appendix (not auto-injected on render since
     we do our own rendering of the citation appendix) */

  d-appendix .citation-appendix,
  .d-appendix .citation-appendix {
    font-size: 11px;
    line-height: 15px;
    border-left: 1px solid rgba(0, 0, 0, 0.1);
    padding-left: 18px;
    border: 1px solid rgba(0,0,0,0.1);
    background: rgba(0, 0, 0, 0.02);
    padding: 10px 18px;
    border-radius: 3px;
    color: rgba(150, 150, 150, 1);
    overflow: hidden;
    margin-top: -12px;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  /* Include appendix styles here so they can be overridden */

  d-appendix {
    contain: layout style;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-top: 60px;
    margin-bottom: 0;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    color: rgba(0,0,0,0.5);
    padding-top: 60px;
    padding-bottom: 48px;
  }

  d-appendix h3 {
    grid-column: page-start / text-start;
    font-size: 15px;
    font-weight: 500;
    margin-top: 1em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.65);
  }

  d-appendix h3 + * {
    margin-top: 1em;
  }

  d-appendix ol {
    padding: 0 0 0 15px;
  }

  @media (min-width: 768px) {
    d-appendix ol {
      padding: 0 0 0 30px;
      margin-left: -30px;
    }
  }

  d-appendix li {
    margin-bottom: 1em;
  }

  d-appendix a {
    color: rgba(0, 0, 0, 0.6);
  }

  d-appendix > * {
    grid-column: text;
  }

  d-appendix > d-footnote-list,
  d-appendix > d-citation-list,
  d-appendix > distill-appendix {
    grid-column: screen;
  }

  /* Include footnote styles here so they can be overridden */

  d-footnote-list {
    contain: layout style;
  }

  d-footnote-list > * {
    grid-column: text;
  }

  d-footnote-list a.footnote-backlink {
    color: rgba(0,0,0,0.3);
    padding-left: 0.5em;
  }



  /* Anchor.js */

  .anchorjs-link {
    /*transition: all .25s linear; */
    text-decoration: none;
    border-bottom: none;
  }
  *:hover > .anchorjs-link {
    margin-left: -1.125em !important;
    text-decoration: none;
    border-bottom: none;
  }

  /* Social footer */

  .social_footer {
    margin-top: 30px;
    margin-bottom: 0;
    color: rgba(0,0,0,0.67);
  }

  .disqus-comments {
    margin-right: 30px;
  }

  .disqus-comment-count {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
    cursor: pointer;
  }

  #disqus_thread {
    margin-top: 30px;
  }

  .article-sharing a {
    border-bottom: none;
    margin-right: 8px;
  }

  .article-sharing a:hover {
    border-bottom: none;
  }

  .sidebar-section.subscribe {
    font-size: 12px;
    line-height: 1.6em;
  }

  .subscribe p {
    margin-bottom: 0.5em;
  }


  .article-footer .subscribe {
    font-size: 15px;
    margin-top: 45px;
  }


  .sidebar-section.custom {
    font-size: 12px;
    line-height: 1.6em;
  }

  .custom p {
    margin-bottom: 0.5em;
  }

  /* Styles for listing layout (hide title) */
  .layout-listing d-title, .layout-listing .d-title {
    display: none;
  }

  /* Styles for posts lists (not auto-injected) */


  .posts-with-sidebar {
    padding-left: 45px;
    padding-right: 45px;
  }

  .posts-list .description h2,
  .posts-list .description p {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
  }

  .posts-list .description h2 {
    font-weight: 700;
    border-bottom: none;
    padding-bottom: 0;
  }

  .posts-list h2.post-tag {
    border-bottom: 1px solid rgba(0, 0, 0, 0.2);
    padding-bottom: 12px;
  }
  .posts-list {
    margin-top: 60px;
    margin-bottom: 24px;
  }

  .posts-list .post-preview {
    text-decoration: none;
    overflow: hidden;
    display: block;
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    padding: 24px 0;
  }

  .post-preview-last {
    border-bottom: none !important;
  }

  .posts-list .posts-list-caption {
    grid-column: screen;
    font-weight: 400;
  }

  .posts-list .post-preview h2 {
    margin: 0 0 6px 0;
    line-height: 1.2em;
    font-style: normal;
    font-size: 24px;
  }

  .posts-list .post-preview p {
    margin: 0 0 12px 0;
    line-height: 1.4em;
    font-size: 16px;
  }

  .posts-list .post-preview .thumbnail {
    box-sizing: border-box;
    margin-bottom: 24px;
    position: relative;
    max-width: 500px;
  }
  .posts-list .post-preview img {
    width: 100%;
    display: block;
  }

  .posts-list .metadata {
    font-size: 12px;
    line-height: 1.4em;
    margin-bottom: 18px;
  }

  .posts-list .metadata > * {
    display: inline-block;
  }

  .posts-list .metadata .publishedDate {
    margin-right: 2em;
  }

  .posts-list .metadata .dt-authors {
    display: block;
    margin-top: 0.3em;
    margin-right: 2em;
  }

  .posts-list .dt-tags {
    display: block;
    line-height: 1em;
  }

  .posts-list .dt-tags .dt-tag {
    display: inline-block;
    color: rgba(0,0,0,0.6);
    padding: 0.3em 0.4em;
    margin-right: 0.2em;
    margin-bottom: 0.4em;
    font-size: 60%;
    border: 1px solid rgba(0,0,0,0.2);
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 500;
  }

  .posts-list img {
    opacity: 1;
  }

  .posts-list img[data-src] {
    opacity: 0;
  }

  .posts-more {
    clear: both;
  }


  .posts-sidebar {
    font-size: 16px;
  }

  .posts-sidebar h3 {
    font-size: 16px;
    margin-top: 0;
    margin-bottom: 0.5em;
    font-weight: 400;
    text-transform: uppercase;
  }

  .sidebar-section {
    margin-bottom: 30px;
  }

  .categories ul {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }

  .categories li {
    color: rgba(0, 0, 0, 0.8);
    margin-bottom: 0;
  }

  .categories li>a {
    border-bottom: none;
  }

  .categories li>a:hover {
    border-bottom: 1px solid rgba(0, 0, 0, 0.4);
  }

  .categories .active {
    font-weight: 600;
  }

  .categories .category-count {
    color: rgba(0, 0, 0, 0.4);
  }


  @media(min-width: 768px) {
    .posts-list .post-preview h2 {
      font-size: 26px;
    }
    .posts-list .post-preview .thumbnail {
      float: right;
      width: 30%;
      margin-bottom: 0;
    }
    .posts-list .post-preview .description {
      float: left;
      width: 45%;
    }
    .posts-list .post-preview .metadata {
      float: left;
      width: 20%;
      margin-top: 8px;
    }
    .posts-list .post-preview p {
      margin: 0 0 12px 0;
      line-height: 1.5em;
      font-size: 16px;
    }
    .posts-with-sidebar .posts-list {
      float: left;
      width: 75%;
    }
    .posts-with-sidebar .posts-sidebar {
      float: right;
      width: 20%;
      margin-top: 60px;
      padding-top: 24px;
      padding-bottom: 24px;
    }
  }


  /* Improve display for browsers without grid (IE/Edge <= 15) */

  .downlevel {
    line-height: 1.6em;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", Arial, sans-serif;
    margin: 0;
  }

  .downlevel .d-title {
    padding-top: 6rem;
    padding-bottom: 1.5rem;
  }

  .downlevel .d-title h1 {
    font-size: 50px;
    font-weight: 700;
    line-height: 1.1em;
    margin: 0 0 0.5rem;
  }

  .downlevel .d-title p {
    font-weight: 300;
    font-size: 1.2rem;
    line-height: 1.55em;
    margin-top: 0;
  }

  .downlevel .d-byline {
    padding-top: 0.8em;
    padding-bottom: 0.8em;
    font-size: 0.8rem;
    line-height: 1.8em;
  }

  .downlevel .section-separator {
    border: none;
    border-top: 1px solid rgba(0, 0, 0, 0.1);
  }

  .downlevel .d-article {
    font-size: 1.06rem;
    line-height: 1.7em;
    padding-top: 1rem;
    padding-bottom: 2rem;
  }


  .downlevel .d-appendix {
    padding-left: 0;
    padding-right: 0;
    max-width: none;
    font-size: 0.8em;
    line-height: 1.7em;
    margin-bottom: 0;
    color: rgba(0,0,0,0.5);
    padding-top: 40px;
    padding-bottom: 48px;
  }

  .downlevel .footnotes ol {
    padding-left: 13px;
  }

  .downlevel .base-grid,
  .downlevel .distill-header,
  .downlevel .d-title,
  .downlevel .d-abstract,
  .downlevel .d-article,
  .downlevel .d-appendix,
  .downlevel .distill-appendix,
  .downlevel .d-byline,
  .downlevel .d-footnote-list,
  .downlevel .d-citation-list,
  .downlevel .distill-footer,
  .downlevel .appendix-bottom,
  .downlevel .posts-container {
    padding-left: 40px;
    padding-right: 40px;
  }

  @media(min-width: 768px) {
    .downlevel .base-grid,
    .downlevel .distill-header,
    .downlevel .d-title,
    .downlevel .d-abstract,
    .downlevel .d-article,
    .downlevel .d-appendix,
    .downlevel .distill-appendix,
    .downlevel .d-byline,
    .downlevel .d-footnote-list,
    .downlevel .d-citation-list,
    .downlevel .distill-footer,
    .downlevel .appendix-bottom,
    .downlevel .posts-container {
    padding-left: 150px;
    padding-right: 150px;
    max-width: 900px;
  }
  }

  .downlevel pre code {
    display: block;
    border-left: 2px solid rgba(0, 0, 0, .1);
    padding: 0 0 0 20px;
    font-size: 14px;
  }

  .downlevel code, .downlevel pre {
    color: black;
    background: none;
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
    text-align: left;
    white-space: pre;
    word-spacing: normal;
    word-break: normal;
    word-wrap: normal;
    line-height: 1.5;

    -moz-tab-size: 4;
    -o-tab-size: 4;
    tab-size: 4;

    -webkit-hyphens: none;
    -moz-hyphens: none;
    -ms-hyphens: none;
    hyphens: none;
  }

  .downlevel .posts-list .post-preview {
    color: inherit;
  }



  </style>

  <script type="application/javascript">

  function is_downlevel_browser() {
    if (bowser.isUnsupportedBrowser({ msie: "12", msedge: "16"},
                                   window.navigator.userAgent)) {
      return true;
    } else {
      return window.load_distill_framework === undefined;
    }
  }

  // show body when load is complete
  function on_load_complete() {

    // add anchors
    if (window.anchors) {
      window.anchors.options.placement = 'left';
      window.anchors.add('d-article > h2, d-article > h3, d-article > h4, d-article > h5');
    }


    // set body to visible
    document.body.style.visibility = 'visible';

    // force redraw for leaflet widgets
    if (window.HTMLWidgets) {
      var maps = window.HTMLWidgets.findAll(".leaflet");
      $.each(maps, function(i, el) {
        var map = this.getMap();
        map.invalidateSize();
        map.eachLayer(function(layer) {
          if (layer instanceof L.TileLayer)
            layer.redraw();
        });
      });
    }

    // trigger 'shown' so htmlwidgets resize
    $('d-article').trigger('shown');
  }

  function init_distill() {

    init_common();

    // create front matter
    var front_matter = $('<d-front-matter></d-front-matter>');
    $('#distill-front-matter').wrap(front_matter);

    // create d-title
    $('.d-title').changeElementType('d-title');

    // create d-byline
    var byline = $('<d-byline></d-byline>');
    $('.d-byline').replaceWith(byline);

    // create d-article
    var article = $('<d-article></d-article>');
    $('.d-article').wrap(article).children().unwrap();

    // move posts container into article
    $('.posts-container').appendTo($('d-article'));

    // create d-appendix
    $('.d-appendix').changeElementType('d-appendix');

    // flag indicating that we have appendix items
    var appendix = $('.appendix-bottom').children('h3').length > 0;

    // replace footnotes with <d-footnote>
    $('.footnote-ref').each(function(i, val) {
      appendix = true;
      var href = $(this).attr('href');
      var id = href.replace('#', '');
      var fn = $('#' + id);
      var fn_p = $('#' + id + '>p');
      fn_p.find('.footnote-back').remove();
      var text = fn_p.html();
      var dtfn = $('<d-footnote></d-footnote>');
      dtfn.html(text);
      $(this).replaceWith(dtfn);
    });
    // remove footnotes
    $('.footnotes').remove();

    // move refs into #references-listing
    $('#references-listing').replaceWith($('#refs'));

    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      var id = $(this).attr('id');
      $('.d-contents a[href="#' + id + '"]').parent().remove();
      appendix = true;
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('d-appendix'));
    });

    // show d-appendix if we have appendix content
    $("d-appendix").css('display', appendix ? 'grid' : 'none');

    // localize layout chunks to just output
    $('.layout-chunk').each(function(i, val) {

      // capture layout
      var layout = $(this).attr('data-layout');

      // apply layout to markdown level block elements
      var elements = $(this).children().not('details, div.sourceCode, pre, script');
      elements.each(function(i, el) {
        var layout_div = $('<div class="' + layout + '"></div>');
        if (layout_div.hasClass('shaded')) {
          var shaded_content = $('<div class="shaded-content"></div>');
          $(this).wrap(shaded_content);
          $(this).parent().wrap(layout_div);
        } else {
          $(this).wrap(layout_div);
        }
      });


      // unwrap the layout-chunk div
      $(this).children().unwrap();
    });

    // remove code block used to force  highlighting css
    $('.distill-force-highlighting-css').parent().remove();

    // remove empty line numbers inserted by pandoc when using a
    // custom syntax highlighting theme
    $('code.sourceCode a:empty').remove();

    // load distill framework
    load_distill_framework();

    // wait for window.distillRunlevel == 4 to do post processing
    function distill_post_process() {

      if (!window.distillRunlevel || window.distillRunlevel < 4)
        return;

      // hide author/affiliations entirely if we have no authors
      var front_matter = JSON.parse($("#distill-front-matter").html());
      var have_authors = front_matter.authors && front_matter.authors.length > 0;
      if (!have_authors)
        $('d-byline').addClass('hidden');

      // article with toc class
      $('.d-contents').parent().addClass('d-article-with-toc');

      // strip links that point to #
      $('.authors-affiliations').find('a[href="#"]').removeAttr('href');

      // add orcid ids
      $('.authors-affiliations').find('.author').each(function(i, el) {
        var orcid_id = front_matter.authors[i].orcidID;
        if (orcid_id) {
          var a = $('<a></a>');
          a.attr('href', 'https://orcid.org/' + orcid_id);
          var img = $('<img></img>');
          img.addClass('orcid-id');
          img.attr('alt', 'ORCID ID');
          img.attr('src','data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg==');
          a.append(img);
          $(this).append(a);
        }
      });

      // hide elements of author/affiliations grid that have no value
      function hide_byline_column(caption) {
        $('d-byline').find('h3:contains("' + caption + '")').parent().css('visibility', 'hidden');
      }

      // affiliations
      var have_affiliations = false;
      for (var i = 0; i<front_matter.authors.length; ++i) {
        var author = front_matter.authors[i];
        if (author.affiliation !== "&nbsp;") {
          have_affiliations = true;
          break;
        }
      }
      if (!have_affiliations)
        $('d-byline').find('h3:contains("Affiliations")').css('visibility', 'hidden');

      // published date
      if (!front_matter.publishedDate)
        hide_byline_column("Published");

      // document object identifier
      var doi = $('d-byline').find('h3:contains("DOI")');
      var doi_p = doi.next().empty();
      if (!front_matter.doi) {
        // if we have a citation and valid citationText then link to that
        if ($('#citation').length > 0 && front_matter.citationText) {
          doi.html('Citation');
          $('<a href="#citation"></a>')
            .text(front_matter.citationText)
            .appendTo(doi_p);
        } else {
          hide_byline_column("DOI");
        }
      } else {
        $('<a></a>')
           .attr('href', "https://doi.org/" + front_matter.doi)
           .html(front_matter.doi)
           .appendTo(doi_p);
      }

       // change plural form of authors/affiliations
      if (front_matter.authors.length === 1) {
        var grid = $('.authors-affiliations');
        grid.children('h3:contains("Authors")').text('Author');
        grid.children('h3:contains("Affiliations")').text('Affiliation');
      }

      // remove d-appendix and d-footnote-list local styles
      $('d-appendix > style:first-child').remove();
      $('d-footnote-list > style:first-child').remove();

      // move appendix-bottom entries to the bottom
      $('.appendix-bottom').appendTo('d-appendix').children().unwrap();
      $('.appendix-bottom').remove();

      // hoverable references
      $('span.citation[data-cites]').each(function() {
        if ($(this).children()[0].nodeName == "D-FOOTNOTE") {
          var fn = $(this).children()[0]
          $(this).html(fn.shadowRoot.querySelector("sup"))
          $(this).id = fn.id
          fn.remove()
        }
        var refs = $(this).attr('data-cites').split(" ");
        var refHtml = refs.map(function(ref) {
          return "<p>" + $('#ref-' + ref).html() + "</p>";
        }).join("\n");
        window.tippy(this, {
          allowHTML: true,
          content: refHtml,
          maxWidth: 500,
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start'
        });
      });

      // clear polling timer
      clearInterval(tid);

      // show body now that everything is ready
      on_load_complete();
    }

    var tid = setInterval(distill_post_process, 50);
    distill_post_process();

  }

  function init_downlevel() {

    init_common();

     // insert hr after d-title
    $('.d-title').after($('<hr class="section-separator"/>'));

    // check if we have authors
    var front_matter = JSON.parse($("#distill-front-matter").html());
    var have_authors = front_matter.authors && front_matter.authors.length > 0;

    // manage byline/border
    if (!have_authors)
      $('.d-byline').remove();
    $('.d-byline').after($('<hr class="section-separator"/>'));
    $('.d-byline a').remove();

    // remove toc
    $('.d-contents').remove();

    // move appendix elements
    $('h1.appendix, h2.appendix').each(function(i, val) {
      $(this).changeElementType('h3');
    });
    $('h3.appendix').each(function(i, val) {
      $(this).nextUntil($('h1, h2, h3')).addBack().appendTo($('.d-appendix'));
    });


    // inject headers into references and footnotes
    var refs_header = $('<h3></h3>');
    refs_header.text('References');
    $('#refs').prepend(refs_header);

    var footnotes_header = $('<h3></h3');
    footnotes_header.text('Footnotes');
    $('.footnotes').children('hr').first().replaceWith(footnotes_header);

    // move appendix-bottom entries to the bottom
    $('.appendix-bottom').appendTo('.d-appendix').children().unwrap();
    $('.appendix-bottom').remove();

    // remove appendix if it's empty
    if ($('.d-appendix').children().length === 0)
      $('.d-appendix').remove();

    // prepend separator above appendix
    $('.d-appendix').before($('<hr class="section-separator" style="clear: both"/>'));

    // trim code
    $('pre>code').each(function(i, val) {
      $(this).html($.trim($(this).html()));
    });

    // move posts-container right before article
    $('.posts-container').insertBefore($('.d-article'));

    $('body').addClass('downlevel');

    on_load_complete();
  }


  function init_common() {

    // jquery plugin to change element types
    (function($) {
      $.fn.changeElementType = function(newType) {
        var attrs = {};

        $.each(this[0].attributes, function(idx, attr) {
          attrs[attr.nodeName] = attr.nodeValue;
        });

        this.replaceWith(function() {
          return $("<" + newType + "/>", attrs).append($(this).contents());
        });
      };
    })(jQuery);

    // prevent underline for linked images
    $('a > img').parent().css({'border-bottom' : 'none'});

    // mark non-body figures created by knitr chunks as 100% width
    $('.layout-chunk').each(function(i, val) {
      var figures = $(this).find('img, .html-widget');
      if ($(this).attr('data-layout') !== "l-body") {
        figures.css('width', '100%');
      } else {
        figures.css('max-width', '100%');
        figures.filter("[width]").each(function(i, val) {
          var fig = $(this);
          fig.css('width', fig.attr('width') + 'px');
        });

      }
    });

    // auto-append index.html to post-preview links in file: protocol
    // and in rstudio ide preview
    $('.post-preview').each(function(i, val) {
      if (window.location.protocol === "file:")
        $(this).attr('href', $(this).attr('href') + "index.html");
    });

    // get rid of index.html references in header
    if (window.location.protocol !== "file:") {
      $('.distill-site-header a[href]').each(function(i,val) {
        $(this).attr('href', $(this).attr('href').replace("index.html", "./"));
      });
    }

    // add class to pandoc style tables
    $('tr.header').parent('thead').parent('table').addClass('pandoc-table');
    $('.kable-table').children('table').addClass('pandoc-table');

    // add figcaption style to table captions
    $('caption').parent('table').addClass("figcaption");

    // initialize posts list
    if (window.init_posts_list)
      window.init_posts_list();

    // implmement disqus comment link
    $('.disqus-comment-count').click(function() {
      window.headroom_prevent_pin = true;
      $('#disqus_thread').toggleClass('hidden');
      if (!$('#disqus_thread').hasClass('hidden')) {
        var offset = $(this).offset();
        $(window).resize();
        $('html, body').animate({
          scrollTop: offset.top - 35
        });
      }
    });
  }

  document.addEventListener('DOMContentLoaded', function() {
    if (is_downlevel_browser())
      init_downlevel();
    else
      window.addEventListener('WebComponentsReady', init_distill);
  });

  </script>

  <!--/radix_placeholder_distill-->
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/header-attrs-2.11/header-attrs.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/jquery-3.5.1/jquery-3.5.1.min.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/popper-2.6.0/popper.min.js"></script>
  <link href="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy.css" rel="stylesheet" />
  <link href="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy-light-border.css" rel="stylesheet" />
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/tippy-6.2.7/tippy.umd.min.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/anchor-4.2.2/anchor.min.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/bowser-1.9.3/bowser.min.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/webcomponents-2.0.0/webcomponents.js"></script>
  <script src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/distill-2.2.21/template.v2.js"></script>
  <!--radix_placeholder_site_in_header-->
  <!--/radix_placeholder_site_in_header-->


</head>

<body>

<!--radix_placeholder_front_matter-->

<script id="distill-front-matter" type="text/json">
{"title":"Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning","description":"A simulation study to demonstrate the ability of model-based recursive partitioning to identify differential effects in a regression discontinuity design (RDD).","authors":[{"author":"Christopher Loan","authorURL":"#","affiliation":"&nbsp;","affiliationURL":"#","orcidID":""}],"publishedDate":"2022-03-06T00:00:00.000-08:00","citationText":"Loan, 2022"}
</script>

<!--/radix_placeholder_front_matter-->
<!--radix_placeholder_navigation_before_body-->
<!--/radix_placeholder_navigation_before_body-->
<!--radix_placeholder_site_before_body-->
<!--/radix_placeholder_site_before_body-->

<div class="d-title">
<h1>Identifying Subgroup Effects in Regression Discontinuity Designs with Model-Based Recursive Partitioning</h1>
<!--radix_placeholder_categories-->
<div class="dt-tags">
<div class="dt-tag">Model-Based Recursive Partitioning</div>
<div class="dt-tag">Machine Learning</div>
<div class="dt-tag">Plotting</div>
<div class="dt-tag">Simulated Data</div>
</div>
<!--/radix_placeholder_categories-->
<p><p>A simulation study to demonstrate the ability of model-based
recursive partitioning to identify differential effects in a regression
discontinuity design (RDD).</p></p>
</div>

<div class="d-byline">
  Christopher Loan  
  
<br/>2022-03-06
</div>

<div class="d-article">
<div class="d-contents d-contents-float">
<nav class="l-text toc figcaption" id="TOC">
<h3>Contents</h3>
<ul>
<li><a
href="#this-is-a-rough-draft-right-now-only-public-in-order-to-show-for-presentation-to-edld-650">THIS
IS A ROUGH DRAFT RIGHT NOW, ONLY PUBLIC IN ORDER TO SHOW FOR
PRESENTATION TO EDLD 650</a></li>
<li><a href="#getting-started">Getting Started</a></li>
<li><a href="#goal-of-the-project">Goal of the Project:</a></li>
<li><a href="#simulate">Simulate</a>
<ul>
<li><a href="#narrative">Narrative</a></li>
<li><a href="#converting-narrative-to-data">Converting Narrative to
Data</a>
<ul>
<li><a href="#distributions">Distributions</a></li>
<li><a href="#effects">Effects</a></li>
</ul></li>
<li><a href="#code-to-simulate">Code to Simulate</a></li>
<li><a href="#plots-of-simualted-data">Plots of Simualted Data</a>
<ul>
<li><a href="#true-structure">True Structure</a></li>
<li><a href="#naive-estimate">Naive Estimate</a></li>
</ul></li>
</ul></li>
<li><a href="#fit-models">Fit Models</a>
<ul>
<li><a href="#linear-models">Linear Models</a>
<ul>
<li><a href="#naive-rd">Naive RD</a></li>
<li><a href="#overparameterized-rd">Overparameterized RD</a></li>
</ul></li>
<li><a href="#model-based-recursive-partitioning">Model-Based Recursive
Partitioning</a>
<ul>
<li><a href="#hyperparameter-tuning">Hyperparameter tuning</a></li>
<li><a href="#re-fitting-with-optimal-hyperparameters">Re-fitting with
optimal hyperparameters</a></li>
</ul></li>
</ul></li>
<li><a href="#comparing-models">Comparing Models</a>
<ul>
<li><a href="#prediction">Prediction</a></li>
<li><a href="#distribution-of-residuals">Distribution of
Residuals</a></li>
<li><a href="#parameter-estimates">Parameter Estimates</a></li>
<li><a href="#consider-group-size">Consider Group Size</a></li>
</ul></li>
<li><a href="#one-other-way-to-look-at-this">One Other Way to Look at
This</a>
<ul>
<li><a href="#what-these-models-mean-for-outcomes">What these models
mean for outcomes</a></li>
</ul></li>
</ul>
</nav>
</div>
<h1
id="this-is-a-rough-draft-right-now-only-public-in-order-to-show-for-presentation-to-edld-650">THIS
IS A ROUGH DRAFT RIGHT NOW, ONLY PUBLIC IN ORDER TO SHOW FOR
PRESENTATION TO EDLD 650</h1>
<h1 id="getting-started">Getting Started</h1>
<p>This project uses <code>{MASS}</code> in stimulating data,
<code>{tidyverse}</code> for data manipulation and plotting,
<code>{partykit}</code> for model-based recursive partitioning, the
other three—<code>{dials}</code>, <code>{rsample}</code>, and
<code>{gardenr}</code>—are for tuning the model-based recursive
partitioning algorithm.</p>
<p>All of these are available on CRAN, but installation of
<code>{gardenr}</code> will require download from my <a
href="https://github.com/Chhr1s/gardenr">GitHub account</a>, as it’s not
yet on CRAN.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>#devtools::install_github("Chhr1s/gardenr")</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://www.stats.ox.ac.uk/pub/MASS4/'>MASS</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://tidyverse.tidyverse.org'>tidyverse</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://partykit.r-forge.r-project.org/partykit/'>partykit</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://chhr1s.github.io/gardenr/'>gardenr</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dials.tidymodels.org'>dials</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://rsample.tidymodels.org'>rsample</a></span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="goal-of-the-project">Goal of the Project:</h1>
<p>The goal of the project is to demonstrate a situation whereby
unexpected subgroup effects can lead to bias in regression discontinuity
(RD) parameter estimates. Because I’d like to keep a general audience
and also to give a nod to my educational training, I’m going to explain
the simulated data as effects in the data (i.e., I will use
education-specific variable names). Obviously, though, these data are
simulated, meaning the findings are agnostic to discipline.</p>
<h1 id="simulate">Simulate</h1>
<p>Simulations are really useful tools. In the real world, no one can
tell you what’s <strong>actually</strong> underlying many processes.
With simulation, however, I can make up a theoretically reasonable
scenario and then demonstrate the effect that would have on statistical
inference.</p>
<h2 id="narrative">Narrative</h2>
<p>Let’s imagine we have a fall reading intervention given to a sample
of n = 4000 students. Students at the bottom quarter of a normally
distributed test are enrolled in an intensive reading intervention for
the remainder of the school year; other students continue with
“treatment as usual” (i.e., their normal suite of English classes). At
the end of the spring term, all students will take a variant of the test
again.</p>
<p>The intervention’s main goal is to raise scores among students at the
bottom of the distribution. This is an equity intervention, meaning it’s
goal is to help everyone eligible (based on fall reading test); further,
those at the lower end of the distribution of eligible students are
given progressively more support.</p>
<p>Let’s also imagine there is a subgroup of students that make up ~15%
of the student body (~267 students). This could be any form of minority
based on mental health, gender identity, racial/ethnic identity,
religious identity, immigrant status, etc.</p>
<p>In such situations, individuals in the subgroup are particularly
vulnerable to worse educational outcomes because information is
frequently tailored to the majority group either implicitly or
explicitly. For example, if this intervention was made primarily by
individuals outside this subgroup or teachers implementing the
intervention were not from this group, we can imagine content or
delivery of this may not resonate with that subgroup as well as the
primary group. Perhaps this happens from assumptions about student
backgrounds or in other ways. The reason why this hypothetical
intervention is not equally effective does not matter, but let’s assume
it is not.</p>
<p>In this case, the intervention may not work as expected for this
student subgroup. Specifically, perhaps this intervention is written in
a way that actively engages students in the reference group while
leaving out students in the subgroup. This means the implicit assumption
of the intervention is not that it is aimed at helping students at the
bottom of the distribution, but it is helping students of the majority
group at the bottom of the distribution. The distinction is
important.</p>
<p>With content implicitly tailored to the reference group, the
intervention may work as expected: everyone in the intervention is
helped a little bit and those most in need (i.e., with the lowest fall
reading score) get more out of the intervention than those closer to the
threshold. For those in the subgroup, engagement is actively stifled by
the tailoring to majority groups. Thus, those who improve in the
subgroup will be those who were internally motivated the most. We can
imagine this would be the students closest to the cutoff of eligibility.
Explicitly, this means that— for the subgroup—the intervention is
actively increasing variance in spring reading scores by having
progressively greater iatrogenic effects on those with the lowest fall
reading score. In other words, the intervention is great for the
reference group in the population, but harmful to those in the
subgroup.</p>
<h2 id="converting-narrative-to-data">Converting Narrative to Data</h2>
<h3 id="distributions">Distributions</h3>
<p>Alongside a few assumptions, we have established all of the
parameters necessary for simulation in the prior narrative. Let’s assume
all variables are standardized with a mean of 0 and a standard deviation
of 1; these variables are also uncorrelated. Student group — a
dichotomous variable—was made with thresholds of the quantile
distribution function, basically binning simulated data where 15% was
put in the subgroup and 85% was in the reference. A continuous
“nuisance” variable was made to be fully uncorrelated with other
variables and the outcome; similarly, a 4-level categorical nuisance
variable (which could be represented by dummy coding) was also
simulated.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>proportion_reference_group</span> <span class='op'>=</span> <span class='fl'>0.85</span>
<span class='va'>threshold_score</span> <span class='op'>=</span> <span class='fl'>0.25</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span>seed <span class='op'>=</span> <span class='fl'>143627</span><span class='op'>)</span>

<span class='co'># variance/covariance matrix</span>
<span class='va'>vcov_matrix</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/cbind.html'>rbind</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span>, 
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>, 
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>
  <span class='op'>)</span>
<span class='co'># means of continuous variables</span>
<span class='va'>means_vector</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span><span class='op'>)</span> 
<span class='co'># number of cases we want</span>
<span class='va'>number_of_cases</span> <span class='op'>&lt;-</span> <span class='fl'>4000</span>
</code></pre>
</div>
</details>
</div>
<h3 id="effects">Effects</h3>
<p>This model was used to simulate data:</p>
<p><span class="math display">\[
\begin{aligned}
    \operatorname{SpringReading} = \\
    \alpha + \beta_{1}(\operatorname{FallReading}) +
\beta_{2}(\operatorname{StudentGroup}_{\operatorname{Subgroup}}) + \\
    \beta_{3}(\operatorname{Treatment}_{\operatorname{Intervention}}) +
\beta_{4}(\operatorname{FallReading} \times
\operatorname{Treatment}_{\operatorname{Intervention}}) + \\
    \beta_{5}(\operatorname{FallReading} \times
\operatorname{StudentGroup}_{\operatorname{Subgroup}}) + \\
    \beta_{6}(\operatorname{StudentGroup}_{\operatorname{Subgroup}}
\times \operatorname{Treatment}_{\operatorname{Intervention}}) + \\
\beta_{7}(\operatorname{FallReading}
\times  \operatorname{StudentGroup}_{\operatorname{Subgroup}} \times
\operatorname{Treatment}_{\operatorname{Intervention}}) + \epsilon
\end{aligned}
\]</span></p>
<p>Five non-zero combinations of effects were specified.</p>
<ul>
<li><span class="math inline">\(\beta_{1} = 1.2\)</span></li>
<li><span class="math inline">\(\beta_{3} = 0.3\)</span></li>
<li><span class="math inline">\(\beta_{4} = -0.4\)</span></li>
<li><span class="math inline">\(\beta_{6} = -0.6\)</span></li>
<li><span class="math inline">\(\beta_{7} = 0.7\)</span></li>
</ul>
<p>Excluding nuisance variables, two effects were set at 0:</p>
<ul>
<li><span class="math inline">\(\beta_{2} = 0\)</span></li>
<li><span class="math inline">\(\beta_{5} = 0\)</span></li>
</ul>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>effs</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span>
    a <span class='op'>=</span> <span class='fl'>1</span>, <span class='co'># loading of intercept spring score (NOT ACTUAL INTERCEPT)</span>
    b1 <span class='op'>=</span> <span class='fl'>1.2</span>, <span class='co'># fall reading  </span>
    b2 <span class='op'>=</span> <span class='fl'>0.3</span>, <span class='co'># intervention</span>
    b3 <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.4</span>, <span class='co'># (fall reading x intervention)</span>
    b4 <span class='op'>=</span> <span class='fl'>0</span>, <span class='co'># student group</span>
    b5 <span class='op'>=</span> <span class='fl'>0</span>, <span class='co'># (fall reading x student group)</span>
    b6 <span class='op'>=</span> <span class='op'>-</span><span class='fl'>0.6</span>, <span class='co'># (intervention x student group)</span>
    b7 <span class='op'>=</span> <span class='fl'>0.6</span>, <span class='co'># ((fall reading x intervention) x student group)</span>
    b8 <span class='op'>=</span> <span class='fl'>0</span>, <span class='co'># continuous nuisance variable</span>
    b9 <span class='op'>=</span> <span class='fl'>0</span>, <span class='co'># categorical nuisance variable</span>
    e <span class='op'>=</span> <span class='fl'>1</span> <span class='co'># loading of error term (NOT ACTUAL ERROR TERM)</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="code-to-simulate">Code to Simulate</h2>
<p>I’ve provided code here for anyone interested in the simulation call.
If you’re more visual, the plots below will show the results of the
simulation better.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'>&lt;-</span> 
  <span class='fu'>MASS</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/MASS/man/mvrnorm.html'>mvrnorm</a></span><span class='op'>(</span>
  n <span class='op'>=</span> <span class='va'>number_of_cases</span>, 
  mu <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>ncol</a></span><span class='op'>(</span><span class='va'>vcov_matrix</span><span class='op'>)</span><span class='op'>)</span>, 
  Sigma <span class='op'>=</span> <span class='va'>vcov_matrix</span>,
  empirical <span class='op'>=</span> <span class='cn'>TRUE</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span><span class='op'>(</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>
    underlying_demo_dist <span class='op'>=</span> <span class='va'>X1</span>,
    reading_fall <span class='op'>=</span> <span class='va'>X2</span>,
    nuisance <span class='op'>=</span> <span class='va'>X3</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    student_group <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span>
        <span class='va'>underlying_demo_dist</span> <span class='op'>&lt;=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>-</span><span class='va'>proportion_reference_group</span><span class='op'>)</span>,
        <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>, 
    treatment <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span><span class='op'>(</span>
        <span class='va'>reading_fall</span> <span class='op'>&lt;=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='va'>threshold_score</span><span class='op'>)</span>, 
        <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>, 
    error <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
    nuisance <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span><span class='op'>(</span>n <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>, <span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>, 
    nuisance_categorical <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/Binomial.html'>rbinom</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>.</span><span class='op'>)</span>, <span class='fl'>3</span>, <span class='fl'>0.5</span><span class='op'>)</span>,
    intercept_outcome <span class='op'>=</span> <span class='fl'>0</span>,
    <span class='co'># equation for the outcome</span>
    reading_spring <span class='op'>=</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>a</span><span class='op'>*</span><span class='va'>intercept_outcome</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b1</span><span class='op'>*</span><span class='va'>reading_fall</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b2</span><span class='op'>*</span><span class='va'>treatment</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b3</span><span class='op'>*</span><span class='va'>reading_fall</span><span class='op'>*</span><span class='va'>treatment</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b4</span><span class='op'>*</span><span class='va'>student_group</span> <span class='op'>+</span>
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b5</span><span class='op'>*</span><span class='va'>reading_fall</span><span class='op'>*</span><span class='va'>student_group</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b6</span><span class='op'>*</span><span class='va'>treatment</span><span class='op'>*</span><span class='va'>student_group</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b7</span><span class='op'>*</span><span class='va'>reading_fall</span><span class='op'>*</span><span class='va'>treatment</span><span class='op'>*</span><span class='va'>student_group</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b8</span><span class='op'>*</span><span class='va'>nuisance</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b9</span><span class='op'>*</span><span class='va'>nuisance_categorical</span> <span class='op'>+</span> 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>e</span><span class='op'>*</span><span class='va'>error</span>,
    student_group <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
        <span class='va'>student_group</span>, 
        levels <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, 
        labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Reference'</span>, <span class='st'>'Subgroup'</span><span class='op'>)</span>
        <span class='op'>)</span>,
    treatment <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
        <span class='va'>treatment</span>, 
        levels <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>1</span>, 
        labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Control'</span>, <span class='st'>'Intervention'</span><span class='op'>)</span>
        <span class='op'>)</span>,
    nuisance_categorical <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span><span class='op'>(</span>
        <span class='va'>nuisance_categorical</span>, 
        levels <span class='op'>=</span> <span class='fl'>0</span><span class='op'>:</span><span class='fl'>3</span>, 
        labels <span class='op'>=</span> <span class='va'>letters</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>]</span>
        <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
      <span class='fu'><a href='https://rdrr.io/pkg/MASS/man/lm.ridge.html'>select</a></span><span class='op'>(</span>
        <span class='va'>reading_spring</span>, 
        <span class='va'>reading_fall</span>,
        <span class='va'>treatment</span>, 
        <span class='va'>student_group</span>,
        <span class='va'>nuisance</span>, 
        <span class='va'>nuisance_categorical</span>
        <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="plots-of-simualted-data">Plots of Simualted Data</h2>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>project_theme</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_bw</a></span><span class='op'>(</span>base_size <span class='op'>=</span> <span class='fl'>18</span><span class='op'>)</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>
      plot.title.position <span class='op'>=</span> <span class='st'>'plot'</span>,
      legend.text <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>size <span class='op'>=</span> <span class='fl'>11</span><span class='op'>)</span>,
      legend.position <span class='op'>=</span> <span class='st'>'bottom'</span>
      <span class='op'>)</span>, 
    <span class='fu'>colorblindr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/colorblindr/man/scale_OkabeIto.html'>scale_color_OkabeIto</a></span><span class='op'>(</span>order <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>2</span>, <span class='fl'>7</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>,
    <span class='fu'>colorblindr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/colorblindr/man/scale_OkabeIto.html'>scale_fill_OkabeIto</a></span><span class='op'>(</span>order <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>6</span>, <span class='fl'>2</span>, <span class='fl'>7</span>, <span class='fl'>5</span><span class='op'>)</span><span class='op'>)</span>
    <span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<h3 id="true-structure">True Structure</h3>
<p>This is the structure of the actual data. We can see that the
intervention helped boost the performance of those in the reference
group across the board and it helped those at the lowest end the most.
For the subgroup, we see the exact opposite effect: universal negative
effect with the least detriment to those lower on fall reading
score.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>fully_specified_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    reading_fall_bin <span class='op'>=</span> <span class='fu'>plyr</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/plyr/man/round_any.html'>round_any</a></span><span class='op'>(</span><span class='va'>reading_fall</span>, <span class='fl'>0.2</span><span class='op'>)</span>,
    plt_intx <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='va'>student_group</span>, <span class='st'>' &amp; \n'</span>, <span class='va'>treatment</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='va'>reading_fall</span>, 
      y <span class='op'>=</span> <span class='va'>reading_spring</span>,
      shape <span class='op'>=</span> <span class='va'>student_group</span>
      <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>
    intercept <span class='op'>=</span> <span class='fl'>0</span>, 
    slope <span class='op'>=</span> <span class='fl'>1</span>, 
    size <span class='op'>=</span> <span class='fl'>1.5</span>, 
    linetype <span class='op'>=</span> <span class='fl'>2</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.4</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>plt_intx</span>, color <span class='op'>=</span> <span class='va'>plt_intx</span><span class='op'>)</span>, 
    size <span class='op'>=</span> <span class='fl'>2</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>, 
    se <span class='op'>=</span> <span class='cn'>FALSE</span>, 
    method <span class='op'>=</span> <span class='st'>'lm'</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='st'>'Spring Reading Score'</span>,
    x <span class='op'>=</span> <span class='st'>'Fall Reading Score'</span>,
    color <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    shape <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 1. Association of Fall and Spring Reading'</span>,
    subtitle <span class='op'>=</span> <span class='st'>'Associations by Treatment Condition &amp; Subgroup'</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>student_group</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='va'>project_theme</span>
<span class='va'>fully_specified_plot</span>
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-6-1.png" width="768" /></p>
</div>
<h3 id="naive-estimate">Naive Estimate</h3>
<p>If a researcher wanted to see the raw effect of this intervention,
they might plot this without the subgroups. Because the subgroup only
contains 15% of the sample, this intervention still looks effective; as
shown above, though, it’s effect is heterogenous when specified
properly.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>naive_specified_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='va'>reading_fall</span>, 
      y <span class='op'>=</span> <span class='va'>reading_spring</span>,
      shape <span class='op'>=</span> <span class='va'>treatment</span>
      <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_abline</a></span><span class='op'>(</span>
    intercept <span class='op'>=</span> <span class='fl'>0</span>, 
    slope <span class='op'>=</span> <span class='fl'>1</span>, 
    size <span class='op'>=</span> <span class='fl'>1.5</span>, 
    linetype <span class='op'>=</span> <span class='fl'>2</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      group <span class='op'>=</span> <span class='va'>treatment</span>, 
      color <span class='op'>=</span> <span class='va'>treatment</span>
      <span class='op'>)</span>, 
    size <span class='op'>=</span> <span class='fl'>2</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>, 
    se <span class='op'>=</span> <span class='cn'>FALSE</span>, 
    method <span class='op'>=</span> <span class='st'>'lm'</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='st'>'Spring Reading Score'</span>,
    x <span class='op'>=</span> <span class='st'>'Fall Reading Score'</span>,
    color <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    shape <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 2. Association of Fall and Spring Reading'</span>,
    subtitle <span class='op'>=</span> <span class='st'>'Associations by Treatment Condition'</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>project_theme</span>
  
<span class='va'>naive_specified_plot</span>
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-7-1.png" width="768" /></p>
</div>
<h1 id="fit-models">Fit Models</h1>
<p>Now that we’ve had a quick visual exploration, let’s fit a
traditional RD model. Let’s also assume that the researcher is able to
identify the subgroup of students and decides to account for the effects
as a dummy-coded fixed effect, the most common approach to control for a
subgroup effect by analysts. After all, if the researcher could not
identify these groups, then no method will help you and you’ll need a
survey methodologist.</p>
<p>Before I fit the models, I have to do some housekeeping.
Specifically, because we’re going to use model-based recursive
partitioning, I like to separate my data into training and testing. I
also need to define a function for cross-validation I call it
<code>cv_it()</code> and it’s a simplified version of
<code>cross_validate_it()</code> from my <code>{gardenr}</code> package.
The only difference is this uses <code>lmtree()</code> instead of
<code>lmertree()</code>, which is because we rely on single level data
instead of a multilevel model.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='fl'>143627</span><span class='op'>)</span>
<span class='va'>sim_split</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>initial_split</a></span><span class='op'>(</span><span class='va'>dat</span><span class='op'>)</span>
<span class='va'>training_data</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>training</a></span><span class='op'>(</span><span class='va'>sim_split</span><span class='op'>)</span>
<span class='va'>comparison_testing</span> <span class='op'>&lt;-</span> <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/initial_split.html'>testing</a></span><span class='op'>(</span><span class='va'>sim_split</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>### cross validation function</span>
<span class='va'>cv_it</span> <span class='op'>&lt;-</span> 
  <span class='kw'>function</span> <span class='op'>(</span>
    <span class='va'>cv_obj</span>, 
    <span class='va'>seed</span> <span class='op'>=</span> <span class='fl'>713</span>, 
    <span class='va'>mod_formula</span>, 
    <span class='va'>tuning_grid</span>, 
    <span class='va'>verbose</span> <span class='op'>=</span> <span class='cn'>FALSE</span>,
    <span class='va'>...</span><span class='op'>)</span> 
  <span class='op'>{</span>
    <span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span><span class='op'>(</span><span class='va'>seed</span><span class='op'>)</span>
    <span class='va'>number_cv_sets</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>cv_obj</span><span class='op'>$</span><span class='va'>splits</span><span class='op'>)</span>
    
    <span class='va'>results</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span><span class='op'>)</span>
    <span class='kw'>for</span> <span class='op'>(</span><span class='va'>j</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='va'>tuning_grid</span><span class='op'>)</span><span class='op'>)</span><span class='op'>{</span>
      
      <span class='va'>max_depth_temp</span> <span class='op'>&lt;-</span> <span class='va'>tuning_grid</span><span class='op'>$</span><span class='va'>maxdepth_par</span><span class='op'>[[</span><span class='va'>j</span><span class='op'>]</span><span class='op'>]</span>
      <span class='va'>alpha_temp</span> <span class='op'>&lt;-</span> <span class='va'>tuning_grid</span><span class='op'>$</span><span class='va'>alpha_par</span><span class='op'>[[</span><span class='va'>j</span><span class='op'>]</span><span class='op'>]</span>
      <span class='va'>trim_temp</span> <span class='op'>&lt;-</span> <span class='va'>tuning_grid</span><span class='op'>$</span><span class='va'>trim_par</span><span class='op'>[[</span><span class='va'>j</span><span class='op'>]</span><span class='op'>]</span>
      
      <span class='va'>rmse_temp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>'numeric'</span>, length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>number_cv_sets</span><span class='op'>)</span><span class='op'>)</span>
      <span class='va'>mae_temp</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/vector.html'>vector</a></span><span class='op'>(</span>mode <span class='op'>=</span> <span class='st'>'numeric'</span>, length <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>number_cv_sets</span><span class='op'>)</span><span class='op'>)</span>
      <span class='kw'>for</span> <span class='op'>(</span><span class='va'>i</span> <span class='kw'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='va'>number_cv_sets</span><span class='op'>)</span> <span class='op'>{</span>
        
        <span class='va'>temp_analysis</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html'>analysis</a></span><span class='op'>(</span><span class='va'>cv_obj</span><span class='op'>$</span><span class='va'>splits</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
        
        <span class='va'>fitted_result</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/pkg/partykit/man/lmtree.html'>lmtree</a></span><span class='op'>(</span>
          data <span class='op'>=</span> <span class='va'>temp_analysis</span>, 
          formula <span class='op'>=</span> <span class='va'>mod_formula</span>, 
          maxdepth <span class='op'>=</span> <span class='va'>max_depth_temp</span>,
          alpha <span class='op'>=</span> <span class='va'>alpha_temp</span>,
          trim <span class='op'>=</span> <span class='va'>trim_temp</span>,
          <span class='va'>...</span>
          <span class='op'>)</span>
        
        <span class='va'>temp_assessment</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rsample.tidymodels.org/reference/as.data.frame.rsplit.html'>assessment</a></span><span class='op'>(</span><span class='va'>cv_obj</span><span class='op'>$</span><span class='va'>splits</span><span class='op'>[[</span><span class='va'>i</span><span class='op'>]</span><span class='op'>]</span><span class='op'>)</span>
        <span class='va'>temp_predictions</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>fitted_result</span>,newdata <span class='op'>=</span> <span class='va'>temp_assessment</span><span class='op'>)</span>
        <span class='va'>temp_new_Y</span> <span class='op'>&lt;-</span> <span class='va'>temp_assessment</span><span class='op'>[[</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='fu'>formula.tools</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/formula.tools/man/formula.parts.html'>lhs</a></span><span class='op'>(</span><span class='va'>mod_formula</span><span class='op'>)</span><span class='op'>)</span><span class='op'>]</span><span class='op'>]</span>
        <span class='va'>rmse_temp</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/rmse.html'>rmse</a></span><span class='op'>(</span>observed_y <span class='op'>=</span> <span class='va'>temp_new_Y</span>, predicted_y <span class='op'>=</span> <span class='va'>temp_predictions</span><span class='op'>)</span>
        <span class='va'>mae_temp</span><span class='op'>[</span><span class='va'>i</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/mae.html'>mae</a></span><span class='op'>(</span>observed_y <span class='op'>=</span> <span class='va'>temp_new_Y</span>, predicted_y <span class='op'>=</span> <span class='va'>temp_predictions</span><span class='op'>)</span>
        
        <span class='kw'>if</span><span class='op'>(</span><span class='va'>verbose</span> <span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"cv index "</span>, <span class='va'>i</span>, <span class='st'>" complete"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>}</span>
      <span class='op'>}</span>
      <span class='va'>mean_rmse</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>rmse_temp</span><span class='op'>)</span>
      <span class='va'>mean_mae</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>mae_temp</span><span class='op'>)</span>
      
      <span class='va'>se_rmse</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>rmse_temp</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>rmse_temp</span><span class='op'>)</span><span class='op'>)</span>
      <span class='va'>se_mae</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/sd.html'>sd</a></span><span class='op'>(</span><span class='va'>mae_temp</span><span class='op'>)</span><span class='op'>/</span><span class='fu'><a href='https://rdrr.io/r/base/MathFun.html'>sqrt</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span><span class='op'>(</span><span class='va'>mae_temp</span><span class='op'>)</span><span class='op'>)</span>
      
      <span class='va'>temp_results</span> <span class='op'>&lt;-</span> 
        <span class='va'>tuning_grid</span><span class='op'>[</span><span class='va'>j</span>, <span class='op'>]</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
        <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
          grid_index <span class='op'>=</span> <span class='va'>j</span>, 
          mean_rmse <span class='op'>=</span> <span class='va'>mean_rmse</span>, 
          se_rmse <span class='op'>=</span> <span class='va'>se_rmse</span>,
          mean_mae <span class='op'>=</span> <span class='va'>mean_mae</span>,
          se_mae <span class='op'>=</span> <span class='va'>se_mae</span>
        <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
        <span class='fu'><a href='https://rdrr.io/pkg/MASS/man/lm.ridge.html'>select</a></span><span class='op'>(</span><span class='va'>grid_index</span>, <span class='fu'><a href='https://tidyselect.r-lib.org/reference/everything.html'>everything</a></span><span class='op'>(</span><span class='op'>)</span><span class='op'>)</span>
      
      
      <span class='va'>results</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/bind.html'>bind_rows</a></span><span class='op'>(</span><span class='va'>results</span>, <span class='va'>temp_results</span><span class='op'>)</span>
      <span class='kw'>if</span><span class='op'>(</span><span class='va'>verbose</span> <span class='op'>==</span> <span class='cn'>TRUE</span><span class='op'>)</span> <span class='op'>{</span><span class='fu'><a href='https://rdrr.io/r/base/message.html'>message</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span><span class='op'>(</span><span class='st'>"hyperparameter index "</span>, <span class='va'>j</span>, <span class='st'>" complete"</span><span class='op'>)</span><span class='op'>)</span><span class='op'>}</span>
      
    <span class='op'>}</span>
    <span class='kw'><a href='https://rdrr.io/r/base/function.html'>return</a></span><span class='op'>(</span><span class='va'>results</span><span class='op'>)</span>
  <span class='op'>}</span>
</code></pre>
</div>
</details>
</div>
<h2 id="linear-models">Linear Models</h2>
<h3 id="naive-rd">Naive RD</h3>
<p>Here’s our naive RD model. It has a fixed effect for fall reading,
treatment condition, their interaction, and the student subgroup. For
treatment condition, the treatment as usual group was used as the
reference in dummy coding. For the student subgroup, the larger group
was used as the reference group in dummy coding. Estimates of these
parameters therefore indicate the fixed effect of the treatment group
compared to the control and the student subgroup compared to the
reference group, respectively.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>naive_lm</span> <span class='op'>&lt;-</span> 
  <span class='va'>training_data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
          <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>+</span> <span class='va'>student_group</span> <span class='op'>+</span> 
          <span class='va'>treatment</span> <span class='op'>+</span> <span class='va'>reading_fall</span><span class='op'>:</span><span class='va'>treatment</span> <span class='op'>+</span> 
          <span class='va'>nuisance</span> <span class='op'>+</span> <span class='va'>nuisance_categorical</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="overparameterized-rd">Overparameterized RD</h3>
<p>An alternative approach that a researcher might take is to fit an
overparameterized RD model. Many would advise against it, but I’m going
to estimate that model too. This model is similar to above, however it
includes all possible interactions of available data. A good analyst
should know not to run this model, but I’m representing the two extremes
here: over- and under-specification of a linear model.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>overparameterized_lm</span> <span class='op'>&lt;-</span> 
  <span class='va'>training_data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
        <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>*</span> <span class='va'>student_group</span> <span class='op'>*</span> <span class='va'>treatment</span> <span class='op'>*</span> <span class='va'>nuisance</span> <span class='op'>*</span> <span class='va'>nuisance_categorical</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h2 id="model-based-recursive-partitioning">Model-Based Recursive
Partitioning</h2>
<h3 id="hyperparameter-tuning">Hyperparameter tuning</h3>
<p>I’m specifying a maximum entropy tuning grid. This basically is going
to take 25 combinations of hyperparameters to cover the parameter space
of (in this case) 3 parameters — maximum depth, alpha, and trim. Maximum
depth is how tall the tree can grow; higher numbers mean the model can
find more subgroups, lower numbers mean the models can find fewer. Even
if the model has a large maximum depth, it will only continue to split
if other splitting rules tell it to do so. Alpha is the significance
needed to justify a split. The null hypothesis is that a single model
explains the data equally well compared to linear models fit to the
subgroups separately. Finally, trim, which is the proportion of the data
which is excluded from the tests of splitting. Higher values of trim
lead to lower proportions of the data being included in parameter split
tests; a trim of 0.25 means that 25% of outliers will be excluded from
these tests.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tuning_grid</span> <span class='op'>&lt;-</span> 
  <span class='fu'>dials</span><span class='fu'>::</span><span class='fu'><a href='https://dials.tidymodels.org/reference/grid_max_entropy.html'>grid_max_entropy</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/maxdepth_par.html'>maxdepth_par</a></span><span class='op'>(</span>maxdepth_min <span class='op'>=</span> <span class='fl'>0L</span>, maxdepth_max <span class='op'>=</span> <span class='fl'>20L</span><span class='op'>)</span>,
    <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/alpha_par.html'>alpha_par</a></span><span class='op'>(</span>alpha_min <span class='op'>=</span> <span class='fl'>0.10</span>, alpha_max <span class='op'>=</span> <span class='fl'>0.001</span><span class='op'>)</span>,
    <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/trim_par.html'>trim_par</a></span><span class='op'>(</span>trim_min <span class='op'>=</span> <span class='fl'>0.01</span>, trim_max <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
    size <span class='op'>=</span> <span class='fl'>25</span>
  <span class='op'>)</span>

<span class='va'>cv</span> <span class='op'>&lt;-</span> 
  <span class='fu'>rsample</span><span class='fu'>::</span><span class='fu'><a href='https://rsample.tidymodels.org/reference/vfold_cv.html'>vfold_cv</a></span><span class='op'>(</span>data <span class='op'>=</span> <span class='va'>training_data</span>, v <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span> 
</code></pre>
</div>
</details>
</div>
<p>Once my tuning grid is created, I use the naive RD estimated model
(i.e.,
<code>reading_spring ~ 1 + reading_fall + treatment + reading_fall:treatment</code>)
and allow the tree to make splits in parameters based on any combination
of student subgroup and nuisance variables.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>cv_estimates</span> <span class='op'>&lt;-</span> 
  <span class='fu'>cv_it</span><span class='op'>(</span>
    cv_obj <span class='op'>=</span> <span class='va'>cv</span>,
    seed <span class='op'>=</span> <span class='fl'>143627</span>,
    tuning_grid <span class='op'>=</span> <span class='va'>tuning_grid</span>,
    mod_formula <span class='op'>=</span> 
        <span class='va'>reading_spring</span> <span class='op'>~</span> 
          <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>+</span> <span class='va'>treatment</span> <span class='op'>+</span> <span class='va'>reading_fall</span><span class='op'>:</span><span class='va'>treatment</span> <span class='op'>|</span> 
          <span class='va'>student_group</span> <span class='op'>+</span>  <span class='va'>nuisance</span> <span class='op'>+</span> <span class='va'>nuisance_categorical</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/arrange.html'>arrange</a></span><span class='op'>(</span><span class='va'>mean_mae</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h3 id="re-fitting-with-optimal-hyperparameters">Re-fitting with optimal
hyperparameters</h3>
<p>I can select best fitting hyperparameters—defined by that with the
lowest average Mean Absolute Error (MAE) across the 10 folds—and then
fit that to the training data. This will then be used to predict
outcomes on unseen testing data; by repeating that with naive and
overparameterized linear models, we can see which model has the better
ability to estimate outcomes on unseen data. This is not the main
interest of inferential models, but <em>in my opinion</em> good
predictions should be an important consideration even in inferential
modeling.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tree_training</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/partykit/man/lmtree.html'>lmtree</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>training_data</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
          <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>+</span> <span class='va'>treatment</span> <span class='op'>+</span> <span class='va'>reading_fall</span><span class='op'>:</span><span class='va'>treatment</span> <span class='op'>|</span> 
          <span class='va'>student_group</span> <span class='op'>+</span>  <span class='va'>nuisance</span> <span class='op'>+</span> <span class='va'>nuisance_categorical</span>,
    maxdepth <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>maxdepth_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,
    alpha <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>alpha_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,
    trim <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>trim_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
      <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<h1 id="comparing-models">Comparing Models</h1>
<h2 id="prediction">Prediction</h2>
<p>Again, I am not hyperfixated on the ability of these models to
predict the outcome, but I would like to examine this. Model-based
recursive partitioning and the two linear models were fit to unseen
testing data. When we compare MAE for these models, we see that
model-based recursive partitioning outperforms these models ever so
slightly.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>comp_test_long</span> <span class='op'>&lt;-</span> 
  <span class='va'>comparison_testing</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    prediction_lm_naive <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>naive_lm</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>, 
    prediction_lm_overparam <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>overparameterized_lm</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>, 
    prediction_mob <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>tree_training</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>,
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>'prediction_'</span><span class='op'>)</span>,
    names_prefix <span class='op'>=</span> <span class='st'>'prediction_'</span>, 
    names_to <span class='op'>=</span> <span class='st'>'model'</span>,
    values_to <span class='op'>=</span> <span class='st'>'prediction'</span>
  <span class='op'>)</span> 
  
<span class='va'>comp_test_long</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>model</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>
    MAE <span class='op'>=</span> <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/mae.html'>mae</a></span><span class='op'>(</span>observed_y <span class='op'>=</span> <span class='va'>reading_spring</span>, predicted_y <span class='op'>=</span> <span class='va'>prediction</span><span class='op'>)</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 3 × 2
  model             MAE
  &lt;chr&gt;           &lt;dbl&gt;
1 lm_naive     0.000801
2 lm_overparam 0.000786
3 mob          0.000778</code></pre>
</div>
<p>In an equity intervention, we are interested particularly in the
ability of these models to perform well for subgroups in particular. So,
I re-calculated MAE for each model AND subgroup. We can see here that
all models have good fit to the reference group; model-based recursive
partitioning marginally outperforms the others in each case. The
difference is even more drastic in the subgroups.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'>## difference by subgroup</span>
<span class='va'>comp_test_long</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='va'>student_group</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/summarise.html'>summarize</a></span><span class='op'>(</span>
    MAE <span class='op'>=</span> <span class='fu'><a href='https://chhr1s.github.io/gardenr/reference/mae.html'>mae</a></span><span class='op'>(</span>observed_y <span class='op'>=</span> <span class='va'>reading_spring</span>, predicted_y <span class='op'>=</span> <span class='va'>prediction</span><span class='op'>)</span>
    <span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 6 × 3
# Groups:   model [3]
  model        student_group      MAE
  &lt;chr&gt;        &lt;fct&gt;            &lt;dbl&gt;
1 lm_naive     Reference     0.000914
2 lm_naive     Subgroup      0.00637 
3 lm_overparam Reference     0.000908
4 lm_overparam Subgroup      0.00587 
5 mob          Reference     0.000907
6 mob          Subgroup      0.00546 </code></pre>
</div>
<h2 id="distribution-of-residuals">Distribution of Residuals</h2>
<p>We can see something similar by plotting distribution of residuals by
subgroup. We can see that the residuals are (relatively) normally
distributed around 0 in both reference conditions, but for the subgroup,
the models are less normally distributed around 0. The naive linear
model has the greatest systematic departure from normal distribution
around 0, with the overparameterized model and model-based recursive
partitioning being closer.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>training_data</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    residual_lm_naive <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>residuals</a></span><span class='op'>(</span><span class='va'>naive_lm</span><span class='op'>)</span>, 
    residual_lm_overparam <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>residuals</a></span><span class='op'>(</span><span class='va'>overparameterized_lm</span><span class='op'>)</span>, 
    residual_mob <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/residuals.html'>residuals</a></span><span class='op'>(</span><span class='va'>tree_training</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>'residual_'</span><span class='op'>)</span>,
    names_prefix <span class='op'>=</span> <span class='st'>'residual_'</span>, 
    names_to <span class='op'>=</span> <span class='st'>'model'</span>,
    values_to <span class='op'>=</span> <span class='st'>'Residuals'</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='va'>Residuals</span>, 
      fill <span class='op'>=</span> <span class='va'>model</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>xintercept <span class='op'>=</span> <span class='fl'>0</span>, size <span class='op'>=</span> <span class='fl'>1.5</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>
    color <span class='op'>=</span> <span class='st'>'black'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>, 
    size <span class='op'>=</span> <span class='fl'>2</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>, 
    title <span class='op'>=</span> <span class='st'>'Figure 3. Density Distribution of Residuals'</span>,
    subtitle <span class='op'>=</span> <span class='st'>'Student Group x Treatment Condition Shown'</span>
    <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>student_group</span>, <span class='va'>treatment</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='va'>project_theme</span>
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-17-1.png" width="768" /></p>
</div>
<h2 id="parameter-estimates">Parameter Estimates</h2>
<p>If we’ve got a model we’re settled on, we can use the full data for
inference, with the optimal hyperparameters selected. We should also
re-fit the two linear models to the entire data set to have the most
precise parameter estimates.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>tree_full</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://rdrr.io/pkg/partykit/man/lmtree.html'>lmtree</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>dat</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
          <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>+</span> <span class='va'>treatment</span> <span class='op'>+</span> <span class='va'>reading_fall</span><span class='op'>:</span><span class='va'>treatment</span> <span class='op'>|</span> 
          <span class='va'>student_group</span> <span class='op'>+</span>  <span class='va'>nuisance</span> <span class='op'>+</span> <span class='va'>nuisance_categorical</span>,
    maxdepth <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>maxdepth_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,
    alpha <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>alpha_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>,
    trim <span class='op'>=</span> <span class='va'>cv_estimates</span><span class='op'>$</span><span class='va'>trim_par</span><span class='op'>[[</span><span class='fl'>1</span><span class='op'>]</span><span class='op'>]</span>
      <span class='op'>)</span>

<span class='va'>naive_lm_full</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
          <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>+</span> <span class='va'>student_group</span> <span class='op'>+</span> 
          <span class='va'>treatment</span> <span class='op'>+</span> <span class='va'>reading_fall</span><span class='op'>:</span><span class='va'>treatment</span> <span class='op'>+</span> 
          <span class='va'>nuisance</span> <span class='op'>+</span> <span class='va'>nuisance_categorical</span>
  <span class='op'>)</span>


<span class='va'>overparameterized_lm_full</span> <span class='op'>&lt;-</span> 
  <span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://rdrr.io/r/stats/lm.html'>lm</a></span><span class='op'>(</span>
    data <span class='op'>=</span> <span class='va'>.</span>, 
    formula <span class='op'>=</span> 
      <span class='va'>reading_spring</span> <span class='op'>~</span> 
        <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>reading_fall</span> <span class='op'>*</span> <span class='va'>student_group</span> <span class='op'>*</span> <span class='va'>treatment</span> <span class='op'>*</span> <span class='va'>nuisance</span> <span class='op'>*</span> <span class='va'>nuisance_categorical</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># ignore the ugly code to specify my axis labels :) </span>
<span class='va'>d1</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
    renamed <span class='op'>=</span> 
  <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Intercept\n'</span>,
    <span class='st'>'Reading Score (Fall)\n'</span>, 
    <span class='st'>'Subgroup\n'</span>,
    <span class='st'>'Treatment\n'</span>,
    <span class='st'>'Nuisance\n'</span>, 
    <span class='st'>'Nuisance_d1\n'</span>,
    <span class='st'>'Nuisance_d2\n'</span>,
    <span class='st'>'Nuisance_d3\n'</span>, 
    <span class='st'>'(Reading Score (Fall) x 
        Treatment)\n'</span>,
    <span class='st'>'(Subgroup x 
        Reading Score (Fall)\n)'</span>,
    <span class='st'>'(Subgroup x Treatment)\n'</span>,
    <span class='st'>'(Subgroup x Nuisance)\n'</span>,
    <span class='st'>'(Subgroup x Nuisance_d1)\n'</span>,
    <span class='st'>'(Subgroup x Nuisance_d2)\n'</span>,
    <span class='st'>'(Subgroup x Nuisance_d3)\n'</span>,
    <span class='st'>'(Reading Score (Fall) x 
        Treatment_d x 
        Subgroup)\n'</span>
  <span class='op'>)</span>, 
  true_effects <span class='op'>=</span> 
    <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='va'>effs</span><span class='op'>$</span><span class='va'>b1</span>, <span class='va'>effs</span><span class='op'>$</span><span class='va'>b4</span>,
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b2</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, 
      <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='va'>effs</span><span class='op'>$</span><span class='va'>b3</span>, 
      <span class='va'>effs</span><span class='op'>$</span><span class='va'>b5</span>, <span class='va'>effs</span><span class='op'>$</span><span class='va'>b6</span>, <span class='fl'>0</span>,
      <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='fl'>0</span>, <span class='va'>effs</span><span class='op'>$</span><span class='va'>b7</span><span class='op'>)</span>
  <span class='op'>)</span>


<span class='va'>naive_lm_tidy</span> <span class='op'>&lt;-</span> 
  <span class='fu'>broom</span><span class='fu'>::</span><span class='fu'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span><span class='op'>(</span><span class='va'>naive_lm_full</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    p <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/Round.html'>round</a></span><span class='op'>(</span><span class='va'>p.value</span>, <span class='fl'>4</span><span class='op'>)</span>,
    renamed <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Intercept\n'</span>,
        <span class='st'>'Reading Score (Fall)\n'</span>, 
        <span class='st'>'Subgroup\n'</span>,
        <span class='st'>'Treatment\n'</span>,
        <span class='st'>'Nuisance\n'</span>, 
        <span class='st'>'Nuisance_d1\n'</span>,
        <span class='st'>'Nuisance_d2\n'</span>,
        <span class='st'>'Nuisance_d3\n'</span>, 
        <span class='st'>'(Reading Score (Fall) x 
        Treatment)\n'</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>d1</span><span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>naive_lm_ests_plot</span> <span class='op'>&lt;-</span> 
  <span class='va'>naive_lm_tidy</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      y <span class='op'>=</span> <span class='va'>renamed</span>, 
      x <span class='op'>=</span> <span class='va'>estimate</span>, 
      xmin <span class='op'>=</span> <span class='va'>estimate</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>std.error</span>, 
      xmax <span class='op'>=</span> <span class='va'>estimate</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>std.error</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>
    xintercept <span class='op'>=</span> <span class='fl'>0</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>, 
    size <span class='op'>=</span> <span class='fl'>1.3</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_errorbar</a></span><span class='op'>(</span>width <span class='op'>=</span>  <span class='fl'>0.3</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>
    size <span class='op'>=</span> <span class='fl'>5</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='st'>'Parameters'</span>,
    caption <span class='op'>=</span> <span class='st'>'Circles = Estimates | Error Bars = 1.96 * Std. Error | Diamonds  = True Values'</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 4. Naive Linear Model Estimates'</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/theme.html'>theme</a></span><span class='op'>(</span>axis.text.y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_text</a></span><span class='op'>(</span>angle <span class='op'>=</span> <span class='fl'>10</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>
    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>true_effects</span>, y <span class='op'>=</span> <span class='va'>renamed</span><span class='op'>)</span>,
    color <span class='op'>=</span> <span class='st'>'gray30'</span>,
    shape <span class='op'>=</span> <span class='fl'>5</span>,
    size <span class='op'>=</span> <span class='fl'>5</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>project_theme</span>

<span class='va'>naive_lm_ests_plot</span>
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-20-1.png" width="768" /></p>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='co'># ignore the ugly code to specify my axis labels :) </span>
<span class='va'>d2</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
    Group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Reference'</span>, <span class='st'>'Subgroup'</span><span class='op'>)</span>, <span class='fl'>4</span><span class='op'>)</span>,
    term_renamed <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'Treatment\n'</span>, <span class='fl'>2</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'(Reading Score (Fall) x 
        Treatment)\n'</span>, <span class='fl'>2</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'Reading Score (Fall)\n'</span>, <span class='fl'>2</span><span class='op'>)</span>,
        <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'Intercept\n'</span>, <span class='fl'>2</span><span class='op'>)</span>
        <span class='op'>)</span>,
      term <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'treatmentIntervention'</span>, <span class='fl'>2</span><span class='op'>)</span>, 
      <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'reading_fall:treatmentIntervention'</span>, <span class='fl'>2</span><span class='op'>)</span>, 
      <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'reading_fall'</span>, <span class='fl'>2</span><span class='op'>)</span>,
      <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='st'>'(Intercept)'</span>, <span class='fl'>2</span><span class='op'>)</span>
    <span class='op'>)</span>, 
    effects <span class='op'>=</span> 
      <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>effs</span><span class='op'>$</span><span class='va'>b2</span>, 
        <span class='va'>effs</span><span class='op'>$</span><span class='va'>b2</span> <span class='op'>+</span> <span class='va'>effs</span><span class='op'>$</span><span class='va'>b6</span>,
        <span class='va'>effs</span><span class='op'>$</span><span class='va'>b3</span>,
        <span class='va'>effs</span><span class='op'>$</span><span class='va'>b3</span> <span class='op'>+</span> <span class='va'>effs</span><span class='op'>$</span><span class='va'>b7</span>, 
        <span class='va'>effs</span><span class='op'>$</span><span class='va'>b1</span>,
        <span class='va'>effs</span><span class='op'>$</span><span class='va'>b1</span> <span class='op'>+</span> <span class='va'>effs</span><span class='op'>$</span><span class='va'>b5</span>, 
        <span class='fl'>0</span>, 
        <span class='fl'>0</span> <span class='op'>+</span> <span class='va'>effs</span><span class='op'>$</span><span class='va'>b4</span>
        <span class='op'>)</span>
  <span class='op'>)</span>
</code></pre>
</div>
</details>
</div>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='va'>tree_full</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://purrr.tidyverse.org/reference/map.html'>map_dfr</a></span><span class='op'>(</span><span class='fu'>broom</span><span class='fu'>::</span><span class='va'><a href='https://generics.r-lib.org/reference/tidy.html'>tidy</a></span>, .id <span class='op'>=</span> <span class='st'>'node'</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    Group <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>node</span> <span class='op'>==</span> <span class='fl'>2</span>, <span class='st'>'Reference'</span>, <span class='st'>'Subgroup'</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate-joins.html'>left_join</a></span><span class='op'>(</span><span class='va'>d2</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      y <span class='op'>=</span> <span class='va'>term_renamed</span>, 
      x <span class='op'>=</span> <span class='va'>estimate</span>, 
      color <span class='op'>=</span> <span class='va'>Group</span>,
      xmin <span class='op'>=</span> <span class='va'>estimate</span> <span class='op'>-</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>std.error</span>, 
      xmax <span class='op'>=</span> <span class='va'>estimate</span> <span class='op'>+</span> <span class='fl'>1.96</span><span class='op'>*</span><span class='va'>std.error</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>
    xintercept <span class='op'>=</span> <span class='fl'>0</span>, 
    color <span class='op'>=</span> <span class='st'>'black'</span>, 
    size <span class='op'>=</span> <span class='fl'>1.3</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.5</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_linerange.html'>geom_errorbar</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>group <span class='op'>=</span> <span class='va'>Group</span><span class='op'>)</span>,
    width <span class='op'>=</span>  <span class='fl'>0.3</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>
    size <span class='op'>=</span> <span class='fl'>5</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>,
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_point.html'>geom_point</a></span><span class='op'>(</span>
    position <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/position_dodge.html'>position_dodge</a></span><span class='op'>(</span>width <span class='op'>=</span> <span class='fl'>0.5</span><span class='op'>)</span>,
    inherit.aes <span class='op'>=</span> <span class='cn'>FALSE</span>, 
    mapping <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>x <span class='op'>=</span> <span class='va'>effects</span>, y <span class='op'>=</span> <span class='va'>term_renamed</span>, group <span class='op'>=</span> <span class='va'>Group</span><span class='op'>)</span>, 
    shape <span class='op'>=</span> <span class='fl'>5</span>,
    color <span class='op'>=</span> <span class='st'>'gray30'</span>, 
    size <span class='op'>=</span> <span class='fl'>5</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='st'>'Parameters'</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 5. Model-Based Recursive Partitioning Estimates'</span>,
    caption <span class='op'>=</span> <span class='st'>'Circles = Estimates | Error Bars = 1.96 * Std. Error | Diamonds  = True Values'</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='va'>project_theme</span> 
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-22-1.png" width="768" /></p>
</div>
<h2 id="consider-group-size">Consider Group Size</h2>
<p>Though the point estimate for the effect of the intervention is null,
we should think about our power to detect that effect in a 15% sample.
Here are the group sizes. At the very least, the tree is nice because it
actually</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/count.html'>count</a></span><span class='op'>(</span><span class='va'>treatment</span>, <span class='va'>student_group</span><span class='op'>)</span>
</code></pre>
</div>
</details>
<pre><code># A tibble: 4 × 3
  treatment    student_group     n
  &lt;fct&gt;        &lt;fct&gt;         &lt;int&gt;
1 Control      Reference      2530
2 Control      Subgroup        453
3 Intervention Reference       885
4 Intervention Subgroup        132</code></pre>
</div>
<h1 id="one-other-way-to-look-at-this">One Other Way to Look at
This</h1>
<p>This plot isn’t the easiest to see, but that’s precisely because
model-based recursive partitioning is that accurate. The predicted lines
basically overlap fully with the actual.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='va'>dat</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>
    predictions_tree <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>tree_full</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>,
    predictions_lm <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>naive_lm</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>,
    predictions_op <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>overparameterized_lm</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span><span class='op'>(</span>actual <span class='op'>=</span> <span class='va'>reading_spring</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='va'>predictions_tree</span>, <span class='va'>predictions_lm</span>, <span class='va'>predictions_op</span>, <span class='va'>actual</span><span class='op'>)</span>
    <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='va'>reading_fall</span>,
      y <span class='op'>=</span> <span class='va'>value</span>,
      color <span class='op'>=</span> <span class='va'>name</span>
      <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_smooth.html'>geom_smooth</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>'lm'</span>, se <span class='op'>=</span> <span class='cn'>F</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span><span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='va'>treatment</span>, <span class='va'>student_group</span><span class='op'>)</span>, scales <span class='op'>=</span> <span class='st'>'free'</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='va'>project_theme</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='st'>'Reading Spring'</span>,
    x <span class='op'>=</span> <span class='st'>'Reading Fall'</span>,
    color <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 6. Estimated effects vs. actual effects'</span>
    <span class='op'>)</span> 
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-26-1.png" width="1152" /></p>
</div>
<h2 id="what-these-models-mean-for-outcomes">What these models mean for
outcomes</h2>
<p>We can then simulate data for possible combinations of observed
variables and use these to show what each model says about outcomes.
Because this intervention is targeted (meaning fall reading score
determines intervention status), we can create an expanded grid of all
possible combinations of observed variables for a sequence of possible
values on fall reading score. I’ve chosen to go from -3 standard
deviations to the threshold.</p>
<p>To see the average influence of the intervention that each model
would propose, we can then subtract fall reading score from predicted
spring score. This will tell us what an analyst using only 1 model would
recommend about the intervention given to new individuals. We see here
that the naive linear model thinks the model is good for everyone. Both
MOB and the overparameterized model think that the intervention is good
for those in the reference but bad for those in the subgroup. A
distinction between the overparameterized linear model and the
model-based recursive partitioning model is that the former has a very
wide range of possible outcomes which are purely noise, whereas the
model-based recursive partitioning algorithm finds clear evidence that
the intervention is good for those in the reference and bad —to varying
degrees— for those in the subgroup.</p>
<div class="layout-chunk" data-layout="l-body">
<details>
<summary>
show code
</summary>
<div class="sourceCode">
<pre class="sourceCode r"><code class="sourceCode r"><span class='fu'><a href='https://rdrr.io/r/base/expand.grid.html'>expand.grid</a></span><span class='op'>(</span>
  student_group <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Reference'</span>, <span class='st'>'Subgroup'</span><span class='op'>)</span>,
  reading_fall <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>qnorm</a></span><span class='op'>(</span><span class='va'>threshold_score</span><span class='op'>)</span>, <span class='fl'>0.1</span><span class='op'>)</span>,
  treatment <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'Intervention'</span><span class='op'>)</span>,
  nuisance <span class='op'>=</span>  <span class='fu'><a href='https://rdrr.io/r/base/seq.html'>seq</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span>, <span class='fl'>0.1</span><span class='op'>)</span>, 
  nuisance_categorical <span class='op'>=</span> <span class='va'>letters</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>4</span><span class='op'>]</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tibble.tidyverse.org/reference/tibble.html'>tibble</a></span><span class='op'>(</span>
    prediction_Naive_LinearModel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>naive_lm_full</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>,
    prediction_MOB <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>tree_full</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>,
    prediction_Overparam_LinearModel <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/predict.html'>predict</a></span><span class='op'>(</span><span class='va'>overparameterized_lm_full</span>, newdata <span class='op'>=</span> <span class='va'>.</span><span class='op'>)</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://tidyr.tidyverse.org/reference/pivot_longer.html'>pivot_longer</a></span><span class='op'>(</span>
    cols <span class='op'>=</span> <span class='fu'><a href='https://tidyselect.r-lib.org/reference/starts_with.html'>starts_with</a></span><span class='op'>(</span><span class='st'>'prediction_'</span><span class='op'>)</span>,
    names_prefix <span class='op'>=</span> <span class='st'>'prediction_'</span>, 
    names_to <span class='op'>=</span> <span class='st'>'model'</span>,
    values_to <span class='op'>=</span> <span class='st'>'prediction'</span>
  <span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>diff <span class='op'>=</span> <span class='va'>prediction</span> <span class='op'>-</span> <span class='va'>reading_fall</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/group_by.html'>group_by</a></span><span class='op'>(</span><span class='va'>student_group</span>, <span class='va'>model</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://dplyr.tidyverse.org/reference/mutate.html'>mutate</a></span><span class='op'>(</span>average_diff <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='va'>diff</span><span class='op'>)</span><span class='op'>)</span> <span class='op'><a href='https://magrittr.tidyverse.org/reference/pipe.html'>%&gt;%</a></span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      x <span class='op'>=</span> <span class='va'>diff</span>,
      color <span class='op'>=</span> <span class='va'>student_group</span>, 
      fill <span class='op'>=</span> <span class='va'>student_group</span>
    <span class='op'>)</span>
  <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/labs.html'>labs</a></span><span class='op'>(</span>
    y <span class='op'>=</span> <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/element.html'>element_blank</a></span><span class='op'>(</span><span class='op'>)</span>,
    color <span class='op'>=</span> <span class='st'>'Student Group'</span>,
    fill <span class='op'>=</span> <span class='st'>'Student Group'</span>,
    x <span class='op'>=</span> <span class='st'>'Spring Reading Score - Fall Reading Score'</span>,
    title <span class='op'>=</span> <span class='st'>'Figure 7. Predicted Change in Reading Score for Eligible Students'</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_density.html'>geom_density</a></span><span class='op'>(</span>
    color <span class='op'>=</span> <span class='st'>'black'</span>, 
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>, 
    size <span class='op'>=</span> <span class='fl'>2</span>
  <span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/facet_wrap.html'>facet_wrap</a></span><span class='op'>(</span>
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/vars.html'>vars</a></span><span class='op'>(</span><span class='fu'><a href='https://forcats.tidyverse.org/reference/fct_reorder.html'>fct_reorder</a></span><span class='op'>(</span><span class='va'>model</span>, <span class='fu'><a href='https://dplyr.tidyverse.org/reference/desc.html'>desc</a></span><span class='op'>(</span><span class='va'>diff</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>,
    ncol <span class='op'>=</span> <span class='fl'>1</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>
    alpha <span class='op'>=</span> <span class='fl'>0.6</span>, 
    size <span class='op'>=</span> <span class='fl'>2</span>, 
    linetype <span class='op'>=</span> <span class='fl'>2</span>,
    <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span><span class='op'>(</span>
      color <span class='op'>=</span> <span class='va'>student_group</span>, 
      xintercept <span class='op'>=</span> <span class='va'>average_diff</span>
      <span class='op'>)</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_abline.html'>geom_vline</a></span><span class='op'>(</span>
    color <span class='op'>=</span> <span class='st'>'gray30'</span>, 
    xintercept <span class='op'>=</span> <span class='fl'>0</span>, 
    size <span class='op'>=</span> <span class='fl'>1.4</span>
    <span class='op'>)</span> <span class='op'>+</span>
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_x_continuous</a></span><span class='op'>(</span>limits <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>3</span>, <span class='fl'>3</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>+</span> 
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/scale_continuous.html'>scale_y_continuous</a></span><span class='op'>(</span>breaks <span class='op'>=</span> <span class='cn'>NULL</span><span class='op'>)</span> <span class='op'>+</span>
  <span class='va'>project_theme</span>
</code></pre>
</div>
</details>
<p><img src="identifying-subgroup-effects-in-regression-discontinuity-designs-with-model-based-recursive-partitioning_files/figure-html5/unnamed-chunk-27-1.png" width="1152" /></p>
</div>
<div class="sourceCode" id="cb4"><pre
class="sourceCode r distill-force-highlighting-css"><code class="sourceCode r"></code></pre></div>
<!--radix_placeholder_article_footer-->
<!--/radix_placeholder_article_footer-->
</div>

<div class="d-appendix">
</div>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

<!--radix_placeholder_site_after_body-->
<!--/radix_placeholder_site_after_body-->
<!--radix_placeholder_appendices-->
<div class="appendix-bottom"></div>
<!--/radix_placeholder_appendices-->
<!--radix_placeholder_navigation_after_body-->
<!--/radix_placeholder_navigation_after_body-->

</body>

</html>
